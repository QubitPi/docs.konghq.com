<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Article">

  



<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
    <!-- OneTrust Cookies Consent Notice start for konghq.com -->
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" type="text/javascript" charset="UTF-8" data-domain-script="2c4de954-6bec-4e93-8086-64cb113f151a">
    </script>
    <script type="text/javascript">
    function OptanonWrapper() { }
    </script>
    <!-- OneTrust Cookies Consent Notice end for konghq.com -->

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NL48VKT');</script>
    <!-- End Google Tag Manager -->

    <!-- Recaptcha -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>OpenID Connect
| Kong Docs</title>
  <meta name="description" content="Documentation for Kong, the Cloud Connectivity Company for APIs and Microservices.">
  <meta name="author" content="KongHQ">
  <meta property="og:title" content="OpenID Connect
| Kong Docs">
  <meta property="og:site_name" content="Kong Docs">
  <!-- use share link for facebook -->
  <meta property="og:url" content="https://docs.konghq.com">
  <meta property="og:description" content="Documentation for Kong, the Cloud Connectivity Company for APIs and Microservices.">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="en_US">
  <meta property="og:image" content="https://docs.konghq.com/assets/images/share.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@thekonginc">
  <meta name="twitter:creator" content="@thekonginc">
  <meta name="twitter:url" content="https://docs.konghq.com">
  <meta name="twitter:description" content="Documentation for Kong, the Cloud Connectivity Company for APIs and Microservices.">
  <meta name="twitter:image" content="https://docs.konghq.com/assets/images/share.png">
  <meta property="fb:admins" content="227304446">
  <meta property="fb:admins" content="576641408">
  <meta name="google-site-verification" content="CrU3zp02dNKTe8NSAipL4NCPkrIjDXG8fViTZ-MIzP4">

  

  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "name": "KongHQ",
      "url": "https://docs.konghq.com",
      "logo": "https://docs.konghq.com/assets/images/logo.png",
      "sameAs": [
        "https://www.facebook.com/konginc",
        "https://twitter.com/thekonginc",
        "https://plus.google.com/+mashape"
      ]
    }
  </script>

  <!-- Preload assets -->
  <link rel="dns-prefetch" href="https://cloud.typography.com">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
  <link rel="dns-prefetch" href="https://dev.visualwebsiteoptimizer.com">
  <link rel="dns-prefetch" href="https://cdn.segment.com">

  <link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">

  
    <link rel="canonical" href="https://docs.konghq.com/hub/kong-inc/openid-connect/">
  

  
    <meta name="robots" content="follow,noindex">
  

  <!-- FontAwesome icon font -->
  <script src="https://kit.fontawesome.com/1332a92967.js" crossorigin="anonymous">
  </script>

  
  <script src="/docs.konghq.com/vite/assets/application-MBEAZv6G.js" crossorigin="anonymous" type="module"></script>
<link href="/docs.konghq.com/vite/assets/_commonjsHelpers-4gQjN7DL.js" rel="modulepreload" as="script" crossorigin="anonymous">


  

  

  <link rel="stylesheet" href="/docs.konghq.com/vite/assets/application-T5YiCv-Y.css" media="screen">

  
</head>


  <body id="" data-spy="scroll" data-target="#scroll-sidebar" data-offset="350">

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NL48VKT" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <header class="navbar-v2 closed">
  <a class="skip-main" href="#main">Skip to content</a>
  <!-- uncomment the promo-banner div when adding a new promo banner-->
  <!--also uncomment the promo banner sections in app/assets/stylesheets/header.less and application.js-->
  <!-- <div id="promo-banner">
    <div class="container">
      <div class="closebanner"></div> <strong>2023 API Summit Hackathon: Experiment with AI for APIs (August 28 - September 27) <a
          href="https://konghq.com/conferences/kong-summit/hackathon?utm_medium=website&utm_source=docs-konghq-com&utm_campaign=docs-banner">Learn More &rarr;</a></strong>
    </div>
  </div> -->
  <div class="navbar-content">
    <a href="https://konghq.com" class="navbar-brand col col-xl-auto" target="_blank" rel="noopener noreferrer">
      <img src="/assets/images/logos/kong-logo-blue.svg" alt="Kong Logo" id="kong-logo">
    </a>
    <span class="logo-divider">|</span>
    <a href="/" class="navbar-brand col col-xl-auto">
      <img src="/assets/images/logos/docs-logo-steel.svg" alt="Kong Docs Logo" id="kong-docs-logo">
    </a>

    <div class="separator mobile"></div>
      <div class="search-input-wrapper" id="getkong-algolia-search-input">
    </div>

    <div class="search-results-wrapper"></div>

    <div class="separator"></div>
    <div class="navbar-items" role="navigation" aria-label="Main menu">
      <ul class="navbar-items" role="menubar">
        <li id="top-module-list" aria-haspopup="true" role="menuitem" aria-expanded="false" class="navbar-item main-menu-item with-submenu  active">
          <span tabindex="0" id="docs-link" class="main-menu-item-title">Docs</span>
          <span class="caret"></span>
          <ul class="navbar-item-submenu" role="menu">
            <div class="submenu-section">
              <li role="menuitem" class="docs-dropdown-li">
                <a href="/api/" class="docs-dropdown-li__link" tabindex="-1">
                  <div class="docs-dropdown-li__card">
                    <span class="heading">Explore the API Specs</span>
                    <div class="docs-dropdown-li__card-link">
                      <img src="/assets/images/landing-page/view-all-api-specs.png" alt="View all API Specs">
                      <span class="docs-dropdown-li__card-image">
                        View all API Specs
                        <img src="/assets/images/landing-page/arrow-right.svg" alt="View all API Specs arrow image">
                      </span>
                    </div>
                  </div>
                </a>
              </li>

              <li role="menuitem" class="docs-dropdown-li" tabindex="-1">
                <div class="docs-dropdown-li__section">
                  <div class="docs-dropdown-li__section-title">
                    <span class="heading">Documentation</span>
                  </div>

                  <div class="docs-dropdown-li__section-items">
                    <a class="item item-all" href="/api/" tabindex="-1">
                      <div class="item__description">
                        <div class="item__description-title">API Specs</div>
                      </div>
                    </a>
                    
                      <a class="item" href="/gateway/latest/" tabindex="-1">
                        
                        <div class="item__description">
                          <div class="item__description-title">Kong Gateway</div>
                          <div class="item__description-desc">Lightweight, fast, and flexible cloud-native API gateway</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/konnect/" tabindex="-1">
                        
                        <div class="item__description">
                          <div class="item__description-title">Kong Konnect</div>
                          <div class="item__description-desc">Single platform for SaaS end-to-end connectivity</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/mesh/latest/" tabindex="-1">
                        
                        <div class="item__description">
                          <div class="item__description-title">Kong Mesh</div>
                          <div class="item__description-desc">Enterprise service mesh based on Kuma and Envoy</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/deck/latest/" tabindex="-1">
                        
                        <div class="item__description">
                          <div class="item__description-title">decK</div>
                          <div class="item__description-desc">Helps manage Kongâ€™s configuration in a declarative fashion</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/kubernetes-ingress-controller/latest/" tabindex="-1">
                        
                        <div class="item__description">
                          <div class="item__description-title">Kong Ingress Controller</div>
                          <div class="item__description-desc">Works inside a Kubernetes cluster and configures Kong to proxy traffic</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/gateway-operator/latest/" tabindex="-1">
                        
                        <div class="item__description">
                          <div class="item__description-title">Kong Gateway Operator</div>
                          <div class="item__description-desc">Manage your Kong deployments on Kubernetes using YAML Manifests</div>
                        </div>
                      </a>
                    
                      <a class="item" href="https://docs.insomnia.rest/" tabindex="-1" target="_blank" rel="noopener nofollow noreferrer ">
                        
                        <div class="item__description">
                          <div class="item__description-title">Insomnia</div>
                          <div class="item__description-desc">Collaborative API development platform</div>
                        </div>
                      </a>
                    
                      <a class="item" href="https://kuma.io/docs/" tabindex="-1" target="_blank" rel="noopener nofollow noreferrer ">
                        
                        <div class="item__description">
                          <div class="item__description-title">Kuma</div>
                          <div class="item__description-desc">Open-source distributed control plane with a bundled Envoy Proxy integration</div>
                        </div>
                      </a>
                    
                  </div>
                </div>
              </li>

            </div>
          </ul>
        </li>

        <li role="menuitem" aria-haspopup="true" aria-expanded="false" class="navbar-item main-menu-item with-submenu navbar-item-hub">
          <span id="plugin-link" class="main-menu-item-title" tabindex="0">Plugin Hub</span>
          <span class="caret"></span>
          <ul class="navbar-item-submenu" role="menu">
            <div class="submenu-section">
              <li role="menuitem" class="docs-dropdown-li">
                <a href="/hub/" class="docs-dropdown-li__link" tabindex="-1">
                  <div class="docs-dropdown-li__card">
                    <span class="heading">Explore the Plugin Hub</span>
                    <div class="docs-dropdown-li__card-link">
                      <img src="/assets/images/landing-page/view-all-plugins.svg" alt="View all plugins">
                      <span class="docs-dropdown-li__card-image">
                        View all plugins
                        <img src="/assets/images/landing-page/arrow-right.svg" alt="View all plugins arrow image">
                      </span>
                    </div>
                  </div>
                </a>
              </li>

              <li role="menuitem" class="docs-dropdown-li">
                <div class="docs-dropdown-li__section">
                  <div class="docs-dropdown-li__section-title">
                    <span class="heading">Functionality</span>
                    <a href="/hub/" class="view-all" tabindex="-1">
                      View all
                      <img src="/assets/images/landing-page/arrow-right.svg" alt="View all arrow image">
                    </a>
                  </div>

                  <div class="docs-dropdown-li__section-items">
                    <a class="item item-all" href="/hub/" tabindex="-1">
                      <div class="item__description">
                        <div class="item__description-title">View all plugins</div>
                      </div>
                    </a>

                    
                      <a class="item" href="/hub/?category=authentication" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/lock_person.svg" alt="Authentication's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Authentication</div>
                          <div class="item__description-desc">Protect your services with an authentication layer</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/hub/?category=security" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/shield.svg" alt="Security's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Security</div>
                          <div class="item__description-desc">Protect your services with additional security layer</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/hub/?category=traffic-control" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/route.svg" alt="Traffic Control's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Traffic Control</div>
                          <div class="item__description-desc">Manage, throttle and restrict inbound and outbound API traffic</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/hub/?category=serverless" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/serverless.svg" alt="Serverless's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Serverless</div>
                          <div class="item__description-desc">Invoke serverless functions in combination with other plugins</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/hub/?category=analytics-monitoring" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/bar_chart.svg" alt="Analytics &amp; Monitoring's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Analytics &amp; Monitoring</div>
                          <div class="item__description-desc">Visualize, inspect and monitor APIs and microservices traffic</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/hub/?category=transformations" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/swap_horiz.svg" alt="Transformations's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Transformations</div>
                          <div class="item__description-desc">Transform request and responses on the fly on Kong</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/hub/?category=logging" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/list_alt.svg" alt="Logging's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Logging</div>
                          <div class="item__description-desc">Log request and response data using the best transport for your infrastructure</div>
                        </div>
                      </a>
                    

                  </div>
                </div>
              </li>
            </div>
          </ul>
        </li>
        <li role="menuitem" class="main-menu-item">
          <a href="https://support.konghq.com/" class="navbar-item" target="_blank" rel="noopener nofollow noreferrer ">Support</a>
        </li>
        <li role="menuitem" class="main-menu-item">
          <a href="https://konghq.com/community/" class="navbar-item" target="_blank" rel="noopener noreferrer">Community</a>
        </li>
        <li role="menuitem" class="main-menu-item">
          <a href="https://education.konghq.com" class="navbar-item" target="_blank" rel="noopener nofollow noreferrer ">Kong Academy</a>
        </li>
      </ul>
      <a id="top-cta" href="https://konghq.com/contact-sales?utm_source=docs.konghq.com" class="navbar-button" target="_blank" rel="noopener nofollow noreferrer ">
        Get a Demo
      </a>
      <a id="konnect-cta" href="https://konghq.com/products/kong-konnect/register?utm_medium=referral&amp;utm_source=docs&amp;utm_campaign=gateway-konnect&amp;utm_content=top-nav" class="navbar-button" target="_blank" rel="noopener nofollow noreferrer ">
        Start Free Trial
      </a>
    </div>
    <div id="navbar-menu-toggle-button" class="small-screen-button" aria-label="Toggle navigation">
      <div></div>
      <div></div>
      <div></div>
    </div>
  </div>
</header>


    


<!-- BEGIN PAGE OUTPUT -->
<div class="search-selector">Plugin Hub</div>

<div class="page v2 hub" data-url="/hub/kong-inc/openid-connect/3.2.x/">
  <div class="page--header-background"></div>
  <div class="container">
    


<header class="page-header">
  <div class="page-header--nav">
    <i class="sidebar-toggle"></i>

    
      <ul class="breadcrumbs">
        <li class="breadcrumb-item">
          <a href="/hub/">
            <img src="/assets/images/icons/hub-layout/icn-breadcrumbs.svg" alt="Plugin Hub icon">
          </a>
        </li>
        
          <li class="breadcrumb-item">
            
              <a href="/hub/?category=authentication">Authentication</a>
            
          </li>
        
          <li class="breadcrumb-item active">
            
              <a href="/hub/kong-inc/openid-connect/3.2.x/">OpenID Connect</a>
            
          </li>
        
          <li class="breadcrumb-item">
            
              Introduction
            
          </li>
        
          <li class="breadcrumb-item active">
            
              <a href="/hub/kong-inc/openid-connect/3.2.x/">Overview</a>
            
          </li>
        
      </ul>
    

    <div class="github-links">
  <div class="github-links--edit">
    
      <a href="https://github.com/Kong/docs.konghq.com/edit/main/app/_hub/kong-inc/openid-connect/overview/_index.md" target="_blank" rel="noopener nofollow noreferrer ">
        <img src="/assets/images/icons/third-party/logo-github-white.svg" alt="github-edit-page">Edit this page
      </a>
    
  </div>
  <div class="github-links--issues">
    <a href="https://github.com/Kong/docs.konghq.com/issues" target="_blank" rel="noopener nofollow noreferrer ">
      <img src="/assets/images/icons/documentation/icn-monitoring-white.svg" alt="report-issue">Report an issue</a>
  </div>
</div>


  </div>
  <div class="page-header--info">
    <div class="page-header--info-icon">
      
      <img src="/assets/images/icons/hub/kong-inc_openid-connect.png" alt="header icon">
      
    </div>
    <div class="page-header--info-meta">
      <div class="meta--title">
        <h1 id="main" tabindex="-1">OpenID Connect</h1>

        
          <div>
            <div class="versions-dropdown dropdown">
              <button class="dropdown-button" id="version-dropdown" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                
                Gateway
                

                Version 3.2.x
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" id="version-list" role="menu" aria-labelledby="version-dropdown">
                
                
                <li class="">
                  <a href="/hub/kong-inc/openid-connect/">
                    3.5.x <em>(latest)</em>
                  </a>
                </li>
                
                <li class="">
                  <a href="/hub/kong-inc/openid-connect/3.4.x/">
                    3.4.x
                  </a>
                </li>
                
                <li class="">
                  <a href="/hub/kong-inc/openid-connect/3.3.x/">
                    3.3.x
                  </a>
                </li>
                
                <li class="active">
                  <a href="/hub/kong-inc/openid-connect/3.2.x/">
                    3.2.x
                  </a>
                </li>
                
                <li class="">
                  <a href="/hub/kong-inc/openid-connect/3.1.x/">
                    3.1.x
                  </a>
                </li>
                
                <li class="">
                  <a href="/hub/kong-inc/openid-connect/3.0.x/">
                    3.0.x
                  </a>
                </li>
                
                <li class="">
                  <a href="/hub/kong-inc/openid-connect/2.8.x/">
                    2.8.x
                  </a>
                </li>
                
                <li class="">
                  <a href="/hub/kong-inc/openid-connect/2.7.x/">
                    2.7.x
                  </a>
                </li>
                
                <li class="">
                  <a href="/hub/kong-inc/openid-connect/2.6.x/">
                    2.6.x
                  </a>
                </li>
                
              </ul>
            </div>
          </div>
        
      </div>
      <div class="meta--content">
        <div class="meta--content-title"><span>By Kong Inc.</span></div>
        <div class="meta--content-badges">
          

  <a href="https://konghq.com/pricing" target="_blank" class="badge premium" aria-label="available with Konnect Premium subscription" rel="noopener nofollow noreferrer "> </a>


  <a href="https://konghq.com/pricing" target="_blank" class="badge enterprise" aria-label="available with Kong Gateway Enterprise subscription" rel="noopener nofollow noreferrer "> </a>




        </div>
      </div>
    </div>
  </div>
</header>


    

    <aside class="docs-sidebar">
  <i class="fa fa-times close-sidebar"></i>

  <ul class="sidebar-container" role="tree" aria-label="Plugin's Documentation">
    <li class="sidebar-item plugin-hub" role="none">
      <span role="treeitem" class="sidebar-label">
        <a class="sidebar-link" tabindex="-1" href="/hub/">
          
  <img src="/assets/images/icons/hub-layout/icn-breadcrumbs.svg" alt="">


Plugin Hub

        </a>
      </span>
    </li>

    
      <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-1-introduction-subtree">
    
      
  <img src="/assets/images/icons/hub-layout/icn-overview.svg" alt="">


Introduction


        
          <button class="sidebar-tree-toggle" aria-label="toggle Introduction subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-1-introduction-subtree" role="group" aria-label="Introduction">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/hub/kong-inc/openid-connect/3.2.x/">
        

Overview

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

    
      <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/hub/kong-inc/openid-connect/3.2.x/configuration/">
        
  <img src="/assets/images/icons/hub-layout/icn-configuration.svg" alt="">


Configuration reference

      </a>
    
  </span>

  
</li>

    
      <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-3-using-the-plugin-subtree">
    
      
  <img src="/assets/images/icons/hub-layout/icn-how-to.svg" alt="">


Using the plugin


        
          <button class="sidebar-tree-toggle" aria-label="toggle Using the plugin subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-3-using-the-plugin-subtree" role="group" aria-label="Using the plugin">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/hub/kong-inc/openid-connect/3.2.x/how-to/basic-example/">
        

Basic config examples

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

    
      <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/hub/kong-inc/openid-connect/3.2.x/changelog/">
        
  <img src="/assets/images/icons/hub-layout/icn-changelog.svg" alt="">


Changelog

      </a>
    
  </span>

  
</li>

    
  </ul>
</aside>


    <aside class="docs-toc" id="plugin-toc">
  <i class="fa fa-times close-sidebar"></i>
  <i class="fa fa-chevron-right collapse-toc"></i>
  <i class="far fa-list-alt expand-toc"></i>

  
    <div class="docs-toc-title">
<img src="/assets/images/icons/hub-layout/icn-on-this-page.svg" alt="On this page"><a href="#">On this page</a>
</div>
<ul>
  <li><a href="#important-configuration-parameters" class="active scroll-to">Important Configuration Parameters</a></li>
  <li>
<a href="#records" class="scroll-to">Records</a>
    <ul>
      <li><a href="#jwk-record" class="scroll-to">JWK Record</a></li>
      <li><a href="#host-record" class="scroll-to">Host Record</a></li>
    </ul>
  </li>
  <li>
<a href="#admin-api" class="scroll-to">Admin API</a>
    <ul>
      <li><a href="#discovery-cache" class="scroll-to">Discovery Cache</a></li>
      <li><a href="#json-web-key-set" class="scroll-to">JSON Web Key Set</a></li>
    </ul>
  </li>
  <li>
<a href="#preparations" class="scroll-to">Preparations</a>
    <ul>
      <li><a href="#keycloak-configuration" class="scroll-to">Keycloak Configuration</a></li>
      <li><a href="#kong-configuration" class="scroll-to">Kong Configuration</a></li>
    </ul>
  </li>
  <li>
<a href="#authentication" class="scroll-to">Authentication</a>
    <ul>
      <li><a href="#authorization-code-flow" class="scroll-to">Authorization Code Flow</a></li>
      <li><a href="#password-grant" class="scroll-to">Password Grant</a></li>
      <li><a href="#client-credentials-grant" class="scroll-to">Client Credentials Grant</a></li>
      <li><a href="#refresh-token-grant" class="scroll-to">Refresh Token Grant</a></li>
      <li><a href="#jwt-access-token-authentication" class="scroll-to">JWT Access Token Authentication</a></li>
      <li><a href="#introspection-authentication" class="scroll-to">Introspection Authentication</a></li>
      <li><a href="#user-info-authentication" class="scroll-to">User Info Authentication</a></li>
      <li><a href="#kong-oauth-token-authentication" class="scroll-to">Kong OAuth Token Authentication</a></li>
      <li><a href="#session-authentication" class="scroll-to">Session Authentication</a></li>
    </ul>
  </li>
  <li>
<a href="#authorization" class="scroll-to">Authorization</a>
    <ul>
      <li><a href="#claims-based-authorization" class="scroll-to">Claims Based Authorization</a></li>
      <li><a href="#acl-plugin-authorization" class="scroll-to">ACL Plugin Authorization</a></li>
      <li><a href="#consumer-authorization" class="scroll-to">Consumer Authorization</a></li>
    </ul>
  </li>
  <li><a href="#headers" class="scroll-to">Headers</a></li>
  <li><a href="#logout" class="scroll-to">Logout</a></li>
  <li><a href="#debugging" class="scroll-to">Debugging</a></li>
</ul>

  

  
</aside>


    <div class="page-content-container v2" id="documentation">
      <div class="page-content">
        <div class="content show-anchor-links">
          
      
        
          <div class="old-version-banner">
          You are browsing documentation for an outdated plugin version.
          See the <a href="/hub/kong-inc/openid-connect/">latest documentation here</a>.
          </div>
        
      

      


  
    
      <blockquote class="note" role="alert">
        <p>
          Did you know that you can try this plugin without talking to anyone for just $10/month with Kong Konnect? <a href="https://konghq.com/products/kong-konnect/register?utm_medium=referral&amp;utm_source=docs&amp;utm_campaign=gateway-konnect&amp;utm_content=" target="_blank" rel="noopener nofollow noreferrer ">Get started in under 5 minutes</a>.
        </p>
      </blockquote>
    
  












<blockquote>
  <p>
    <em>Looking for the plugin's configuration parameters? You can find them in the <a href="/hub/kong-inc/openid-connect/3.2.x/configuration/">OpenID Connect configuration reference</a> doc.</em>
  </p>
</blockquote>






<p>OpenID Connect (<a href="http://openid.net/specs/openid-connect-core-1_0.html" target="_blank" rel="noopener nofollow noreferrer ">1.0</a>) plugin allows for integration with a third party
identity provider (IdP) in a standardized way. This plugin can be used to implement
Kong as a (proxying) <a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener nofollow noreferrer ">OAuth 2.0</a> resource server (RS) and/or as an OpenID
Connect relying party (RP) between the client, and the upstream service.</p>

<p>The plugin supports several types of credentials and grants:</p>

<ul>
  <li>Signed <a href="https://tools.ietf.org/html/rfc7519" target="_blank" rel="noopener nofollow noreferrer ">JWT</a> access tokens (<a href="https://tools.ietf.org/html/rfc7515" target="_blank" rel="noopener nofollow noreferrer ">JWS</a>)</li>
  <li>Opaque access tokens</li>
  <li>Refresh tokens</li>
  <li>Authorization code with client secret or PKCE</li>
  <li>Username and password</li>
  <li>Client credentials</li>
  <li>Session cookies</li>
</ul>

<p>The plugin has been tested with several OpenID Connect providers:</p>

<!--vale off-->
<ul>
  <li>
<a href="https://auth0.com/docs/protocols/openid-connect-protocol" target="_blank" rel="noopener nofollow noreferrer ">Auth0</a> (<a href="/gateway/latest/configure/auth/oidc-auth0/">Kong Integration Guide</a>)</li>
  <li>
<a href="https://aws.amazon.com/cognito/" target="_blank" rel="noopener nofollow noreferrer ">Amazon AWS Cognito</a> (<a href="/gateway/latest/configure/auth/oidc-cognito/">Kong Integration Guide</a>)</li>
  <li><a href="https://connect2id.com/products/server" target="_blank" rel="noopener nofollow noreferrer ">Connect2id</a></li>
  <li><a href="https://curity.io/resources/learn/openid-connect-overview/" target="_blank" rel="noopener nofollow noreferrer ">Curity</a></li>
  <li><a href="https://dexidp.io/docs/openid-connect/" target="_blank" rel="noopener nofollow noreferrer ">Dex</a></li>
  <li><a href="https://gluu.org/docs/ce/api-guide/openid-connect-api/" target="_blank" rel="noopener nofollow noreferrer ">Gluu</a></li>
  <li>
<a href="https://developers.google.com/identity/protocols/oauth2/openid-connect" target="_blank" rel="noopener nofollow noreferrer ">Google</a> (<a href="/gateway/latest/configure/auth/oidc-google/">Kong Integration Guide</a>)</li>
  <li><a href="https://duendesoftware.com/" target="_blank" rel="noopener nofollow noreferrer ">IdentityServer</a></li>
  <li><a href="http://www.keycloak.org/" target="_blank" rel="noopener nofollow noreferrer ">Keycloak</a></li>
  <li>
<a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-protocols-oidc" target="_blank" rel="noopener nofollow noreferrer ">Microsoft Azure Active Directory</a> (<a href="/gateway/latest/configure/auth/oidc-azuread/">Kong Integration Guide</a>)</li>
  <li><a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-fs/development/ad-fs-openid-connect-oauth-concepts" target="_blank" rel="noopener nofollow noreferrer ">Microsoft Active Directory Federation Services</a></li>
  <li><a href="https://docs.microsoft.com/en-us/advertising/guides/authentication-oauth-live-connect" target="_blank" rel="noopener nofollow noreferrer ">Microsoft Live Connect</a></li>
  <li>
<a href="https://developer.okta.com/docs/api/resources/oidc.html" target="_blank" rel="noopener nofollow noreferrer ">Okta</a> (<a href="/gateway/latest/configure/auth/oidc-okta/">Kong Integration Guide</a>)</li>
  <li><a href="https://developers.onelogin.com/openid-connect" target="_blank" rel="noopener nofollow noreferrer ">OneLogin</a></li>
  <li><a href="https://backstage.forgerock.com/docs/openam/13.5/admin-guide/#chap-openid-connect" target="_blank" rel="noopener nofollow noreferrer ">OpenAM</a></li>
  <li><a href="https://developer.paypal.com/docs/log-in-with-paypal/integrate/" target="_blank" rel="noopener nofollow noreferrer ">PayPal</a></li>
  <li><a href="https://docs.pingidentity.com/r/en-us/pingfederate-112/pf_pingfederate_landing_page" target="_blank" rel="noopener nofollow noreferrer ">PingFederate</a></li>
  <li><a href="https://help.salesforce.com/articleView?id=sf.sso_provider_openid_connect.htm&amp;type=5" target="_blank" rel="noopener nofollow noreferrer ">Salesforce</a></li>
  <li><a href="https://is.docs.wso2.com/en/latest/guides/identity-federation/configure-oauth2-openid-connect/" target="_blank" rel="noopener nofollow noreferrer ">WSO2</a></li>
  <li><a href="https://developer.yahoo.com/oauth2/guide/openid_connect/" target="_blank" rel="noopener nofollow noreferrer ">Yahoo!</a></li>
</ul>

<p>As long as your provider supports OpenID Connect standards, the plugin should
work, even if it is not specifically tested against it. Let Kong know if you
want your provider to be tested and added to the list.</p>

<!--vale on-->

<p>Once applied, any user with a valid credential can access the service.</p>

<p>This plugin can be used for authentication in conjunction with the
<a href="/hub/kong-inc/application-registration/">Application Registration</a> plugin.</p>

<h2 id="important-configuration-parameters">Important Configuration Parameters</h2>

<p>This plugin includes many configuration parameters that allow finely grained customization.
The following steps will help you get started setting up the plugin:</p>

<ol>
  <li>
    <p>Configure: <code class="language-plaintext highlighter-rouge">config.issuer</code>.</p>

    <p>This parameter tells the plugin where to find discovery information, and it is
 the only required parameter. You should set the value <code class="language-plaintext highlighter-rouge">realm</code> or <code class="language-plaintext highlighter-rouge">iss</code> on this
 parameter if you donâ€™t have a discovery endpoint.</p>

    <blockquote class="note">
      <p><strong>Note</strong>: This does not have
 to match the URL of the <code class="language-plaintext highlighter-rouge">iss</code> claim in the access tokens being validated. To set
 URLs supported in the <code class="language-plaintext highlighter-rouge">iss</code> claim, use <code class="language-plaintext highlighter-rouge">config.issuers_allowed</code>.</p>
    </blockquote>
  </li>
  <li>
    <p>Decide what authentication grants to use with this plugin and configure
 the <code class="language-plaintext highlighter-rouge">config.auth_methods</code> field accordingly.</p>

    <p>In order to restrict the scope of potential attacks, the parameter should only 
 contain the grants that you want to use.</p>
  </li>
  <li>
    <p>In many cases, you also need to specify <code class="language-plaintext highlighter-rouge">config.client_id</code>, and if your identity provider
 requires authentication, such as on a token endpoint, you will need to specify the client
 authentication credentials too, for example <code class="language-plaintext highlighter-rouge">config.client_secret</code>.</p>
  </li>
  <li>
    <p>If you are using a public identity provider, such as Google, you should limit
 the audience with <code class="language-plaintext highlighter-rouge">config.audience_required</code> to contain only your <code class="language-plaintext highlighter-rouge">config.client_id</code>.
 You may also need to adjust <code class="language-plaintext highlighter-rouge">config.audience_claim</code> in case your identity provider
 uses a non-standard claim (other than <code class="language-plaintext highlighter-rouge">aud</code> as specified in JWT standard). This is
 important because some identity providers, such as Google, share public keys
 with different clients.</p>
  </li>
  <li>
    <p>If you are using Kong in DB-less mode with a declarative configuration and 
 session cookie authentication, you should set <code class="language-plaintext highlighter-rouge">config.session_secret</code>.
 Leaving this parameter unset will result in every Nginx worker across your
 nodes encrypting and signing the cookies with their own secrets.</p>
  </li>
</ol>

<p>In summary, start with the following parameters:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">config.issuer</code></li>
  <li><code class="language-plaintext highlighter-rouge">config.auth_methods</code></li>
  <li>
<code class="language-plaintext highlighter-rouge">config.client_id</code> (and in many cases the client authentication credentials)</li>
  <li>
<code class="language-plaintext highlighter-rouge">config.audience_required</code> (if using a public identity provider)</li>
  <li>
<code class="language-plaintext highlighter-rouge">config.session_secret</code> (if using Kong in DB-less mode)</li>
</ol>

<h2 id="records">Records</h2>

<p>In the above parameter list, two configuration settings used an array of records as a data type:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">config.client_jwk</code>: array of JWK records (one for each client)</li>
  <li>
<code class="language-plaintext highlighter-rouge">config.session_redis_cluster_nodes</code>: array of host records, either as IP
addresses or hostnames, and their ports.</li>
</ul>

<p>Below are descriptions of the record types.</p>

<h3 id="jwk-record">JWK Record</h3>

<p>The JSON Web Key (JWK) record is specified in <a href="https://datatracker.ietf.org/doc/html/rfc7517#section-4" target="_blank" rel="noopener nofollow noreferrer ">RFC7517</a>. This record is used with the
<code class="language-plaintext highlighter-rouge">config.client_jwk</code> when using <code class="language-plaintext highlighter-rouge">private_key_jwk</code> client authentication.</p>

<p>Here is an example of JWK record generated by the plugin itself (see: <a href="#json-web-key-set">JSON Web Key Set</a>):</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"kid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B2FxBJ8G_e61tnZEfaYpaMLjswjNO3dbVEQhR7-i_9s"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kty"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RSA"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"alg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RS256"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"use"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sig"</span><span class="w">
    </span><span class="nl">"e"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AQAB"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"n"</span><span class="p">:</span><span class="w"> </span><span class="s2">"â€¦"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"d"</span><span class="p">:</span><span class="w"> </span><span class="s2">"â€¦"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"p"</span><span class="p">:</span><span class="w"> </span><span class="s2">"â€¦"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"q"</span><span class="p">:</span><span class="w"> </span><span class="s2">"â€¦"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"dp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"â€¦"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"dq"</span><span class="p">:</span><span class="w"> </span><span class="s2">"â€¦"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"qi"</span><span class="p">:</span><span class="w"> </span><span class="s2">"â€¦"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<p>The JWK private fields (<code class="language-plaintext highlighter-rouge">k</code>, <code class="language-plaintext highlighter-rouge">d</code>, <code class="language-plaintext highlighter-rouge">p</code>, <code class="language-plaintext highlighter-rouge">q</code>, <code class="language-plaintext highlighter-rouge">dp</code>, <code class="language-plaintext highlighter-rouge">dq</code>, <code class="language-plaintext highlighter-rouge">qi</code>, <code class="language-plaintext highlighter-rouge">oth</code>, <code class="language-plaintext highlighter-rouge">r</code>, <code class="language-plaintext highlighter-rouge">t</code>) are <em>referenceable</em>,
which means they can be securely stored as a
<a href="/gateway/latest/kong-enterprise/secrets-management/getting-started/">secret</a>
in a vault. References must follow a <a href="/gateway/latest/kong-enterprise/secrets-management/reference-format/">specific format</a>.</p>

<h3 id="host-record">Host Record</h3>

<p>The Host record used with the <code class="language-plaintext highlighter-rouge">config.session_redis_cluster_nodes</code> is simple.
It contains <code class="language-plaintext highlighter-rouge">ip</code> or <code class="language-plaintext highlighter-rouge">host</code>, and the <code class="language-plaintext highlighter-rouge">port</code> where the <code class="language-plaintext highlighter-rouge">port</code> defaults to <code class="language-plaintext highlighter-rouge">6379</code>.</p>

<p>Here is an example of Host the record:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"ip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"127.0.0.1"</span><span class="w">
    </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">6379</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<h2 id="admin-api">Admin API</h2>

<p>The OpenID Connect plugin extends the <a href="/gateway/latest/admin-api/">Kong Admin API</a> with a few endpoints.</p>

<h3 id="discovery-cache">Discovery Cache</h3>

<p>When configuring the plugin using <code class="language-plaintext highlighter-rouge">config.issuer</code>, the plugin will store the fetched discovery
information to the Kong database, or in the worker memory with DB-less. The discovery cache does
not have an expiry or TTL, and so must be cleared manually using the <code class="language-plaintext highlighter-rouge">DELETE</code> endpoints listed below.</p>

<p>The discovery cache will attempt to be refreshed when a token is presented with required discovery 
information that is not already available, based on the <code class="language-plaintext highlighter-rouge">config.issuer</code> value. Once a rediscovery attempt 
has been made, a new attempt will not occur until the number of seconds defined in <code class="language-plaintext highlighter-rouge">rediscovery_lifetime</code> 
has elapsed - this avoids excessive discovery requests to the identity provider.</p>

<p>If a JWT cannot be validated due to missing discovery information and an invalid status code is 
received from the rediscovery request (for example, non-2xx), the plugin will attempt to validate the JWT
by falling back to any sufficient discovery information that is still in the discovery cache.</p>

<h5 id="discovery-cache-object">Discovery Cache Object</h5>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;uuid&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;config.issuer&gt;"</span><span class="w">
    </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;timestamp&gt;</span><span class="p">,</span><span class="w">
    </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">&lt;discovery&gt;</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="err">&lt;keys&gt;</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<h4 id="list-all-discovery-cache-objects">List All Discovery Cache Objects</h4>

<div class="endpoint get indent">/openid-connect/issuers</div>

<h5 id="response">Response</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP 200 OK
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;uuid&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;config.issuer&gt;"</span><span class="w">
        </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;timestamp&gt;</span><span class="p">,</span><span class="w">
        </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="err">&lt;discovery&gt;</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="err">&lt;keys&gt;</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}],</span><span class="w">
    </span><span class="nl">"next"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<h4 id="retrieve-discovery-cache-object">Retrieve Discovery Cache Object</h4>

<div class="endpoint get indent">/openid-connect/issuers/{issuer or id}</div>

<table class="indent">
  <thead>
    <tr>
      <th style="text-align: right">Attributes</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">
<code class="language-plaintext highlighter-rouge">issuer or id</code><br><strong>required</strong>
</td>
      <td>The unique identifier <strong>or</strong> the value of <code class="language-plaintext highlighter-rouge">config.issuer</code>
</td>
    </tr>
  </tbody>
</table>

<h5 id="response-1">Response</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP 200 OK
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;uuid&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;config.issuer&gt;"</span><span class="w">
    </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;timestamp&gt;</span><span class="p">,</span><span class="w">
    </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">&lt;discovery&gt;</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="err">&lt;keys&gt;</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<h4 id="delete-all-discovery-cache-objects">Delete All Discovery Cache Objects</h4>

<div class="endpoint delete indent">/openid-connect/issuers</div>

<h5 id="response-2">Response</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP 204 No Content
</code></pre></div></div>

<blockquote class="note">
  <p><strong>Note:</strong> The automatically generated session secret (that can be overridden with the
<code class="language-plaintext highlighter-rouge">config.session_secret</code>) is stored with the discovery cache objects. Deleting discovery cache
objects will invalidate all the sessions created with the associated secret.</p>
</blockquote>

<h4 id="delete-discovery-cache-object">Delete Discovery Cache Object</h4>

<div class="endpoint delete indent">/openid-connect/issuers/{issuer or id}</div>

<table class="indent">
  <thead>
    <tr>
      <th style="text-align: right">Attributes</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">
<code class="language-plaintext highlighter-rouge">issuer or id</code><br><strong>required</strong>
</td>
      <td>The unique identifier <strong>or</strong> the value of <code class="language-plaintext highlighter-rouge">config.issuer</code>
</td>
    </tr>
  </tbody>
</table>

<h5 id="response-3">Response</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP 204 No Content
</code></pre></div></div>

<h3 id="json-web-key-set">JSON Web Key Set</h3>

<p>When the OpenID Connect client (the plugin) is set to communicate with the identity provider endpoints
using <code class="language-plaintext highlighter-rouge">private_key_jwt</code>, the plugin needs to use public key cryptography. Thus, the plugin needs
to generate the needed keys. Identity provider on the other hand has to verify that the assertions
used for the client authentication.</p>

<p>The plugin will automatically generate the key pairs for the different algorithms. It will also
publish the public keys with the admin api where the identity provider could fetch them.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="err">&lt;keys&gt;</span><span class="w">
    </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<h4 id="retrieve-jwks">Retrieve JWKS</h4>

<div class="endpoint get indent">/openid-connect/jwks</div>

<p>This endpoint will return a standard <a href="https://datatracker.ietf.org/doc/html/rfc7517#appendix-A.1" target="_blank" rel="noopener nofollow noreferrer ">JWK Set document</a> with the private keys stripped out.</p>

<h5 id="response-4">Response</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP 200 OK
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="err">&lt;keys&gt;</span><span class="w">
    </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<h4 id="rotate-jwks">Rotate JWKS</h4>

<div class="endpoint delete indent">/openid-connect/jwks</div>

<p>Deleting JWKS will also cause auto-generation of a new JWK set, so
<code class="language-plaintext highlighter-rouge">DELETE</code> will actually cause a key rotation.</p>

<h5 id="response-5">Response</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP 204 No Content
</code></pre></div></div>

<h2 id="preparations">Preparations</h2>

<p>The OpenID Connect plugin relies in most cases on a third party identity provider.
In this section, we explain configuration of Keycloak and Kong.</p>

<p>All the <code class="language-plaintext highlighter-rouge">*.test</code> domains in the following examples point to the <code class="language-plaintext highlighter-rouge">localhost</code> (<code class="language-plaintext highlighter-rouge">127.0.0.1</code> and/or <code class="language-plaintext highlighter-rouge">::1</code>).</p>

<h3 id="keycloak-configuration">Keycloak Configuration</h3>

<p>We use <a href="http://www.keycloak.org/" target="_blank" rel="noopener nofollow noreferrer ">Keycloak</a> as the identity provider in the following examples,
but the steps will be similar in other standard identity providers. If you encounter
difficulties during this phase, please refer to the <a href="https://www.keycloak.org/documentation" target="_blank" rel="noopener nofollow noreferrer ">Keycloak documentation</a>.</p>

<ol>
  <li>Create a confidential client <code class="language-plaintext highlighter-rouge">kong</code> with <code class="language-plaintext highlighter-rouge">private_key_jwt</code> authentication and configure
Keycloak to download the public keys from <a href="#json-web-key-set">the OpenID Connect Plugin JWKS endpoint</a>:
<br><br>
<img src="/assets/images/products/plugins/openid-connect/keycloak-client-kong-settings.png">
<br>
<img src="/assets/images/products/plugins/openid-connect/keycloak-client-kong-auth.png">
<br>
</li>
  <li>Create a confidential client <code class="language-plaintext highlighter-rouge">service</code> with <code class="language-plaintext highlighter-rouge">client_secret_basic</code> authentication.
For this client, Keycloak will auto-generate a secret similar to the following: <code class="language-plaintext highlighter-rouge">cf4c655a-0622-4ce6-a0de-d3353ef0b714</code>.
Enable the client credentials grant for the client:
<br><br>
<img src="/assets/images/products/plugins/openid-connect/keycloak-client-service-settings.png">
<br>
<img src="/assets/images/products/plugins/openid-connect/keycloak-client-service-auth.png">
<br>
</li>
  <li>Create a verified user with the name: <code class="language-plaintext highlighter-rouge">john</code> and the non-temporary password: <code class="language-plaintext highlighter-rouge">doe</code> that can be used with the password grant:
<br><br>
<img src="/assets/images/products/plugins/openid-connect/keycloak-user-john.png">
</li>
</ol>

<p>Alternatively you can <a href="/assets/images/products/plugins/openid-connect/keycloak.json">download the exported Keycloak configuration</a>,
and use it to configure the Keycloak. Please refer to <a href="https://www.keycloak.org/docs/latest/server_admin/#_export_import" target="_blank" rel="noopener nofollow noreferrer ">Keycloak import documentation</a>
for more information.</p>

<p>You need to modify Keycloak <code class="language-plaintext highlighter-rouge">standalone.xml</code> configuration file, and change the socket binding from:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;socket-binding</span> <span class="na">name=</span><span class="s">"https"</span> <span class="na">port=</span><span class="s">"${jboss.https.port:8443}"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>to</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;socket-binding</span> <span class="na">name=</span><span class="s">"https"</span> <span class="na">port=</span><span class="s">"${jboss.https.port:8440}"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>The Keycloak default <code class="language-plaintext highlighter-rouge">https</code> port conflicts with the default Kong TLS proxy port,
and that can be a problem if both are started on the same host.</p>

<h3 id="kong-configuration">Kong Configuration</h3>

<h4 id="create-a-service">Create a Service</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> put :8001/services/openid-connect <span class="nv">url</span><span class="o">=</span>http://httpbin.org/anything
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"httpbin.org"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w">
    </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/anything"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="create-a-route">Create a Route</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> put :8001/services/openid-connect/routes/openid-connect <span class="nv">paths</span><span class="o">=</span>/
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ac1e86bd-4bce-4544-9b30-746667aaa74a"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"paths"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"/"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="create-a-plugin">Create a Plugin</h4>

<p>You may execute this before patching the plugin (as seen on following examples) to reset
the plugin configuration.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> put :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  <span class="nv">name</span><span class="o">=</span>openid-connect                                          <span class="se">\</span>
  service.name<span class="o">=</span>openid-connect                                  <span class="se">\</span>
  config.issuer<span class="o">=</span>http://keycloak.test:8080/auth/realms/master   <span class="se">\</span>
  config.client_id<span class="o">=</span>kong                                        <span class="se">\</span>
  config.client_auth<span class="o">=</span>private_key_jwt
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://keycloak.test:8080/auth/realms/master"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"client_id"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"kong"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"client_auth"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"private_key_jwt"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>Also, check the discovery cache: <code class="language-plaintext highlighter-rouge">http :8001/openid-connect/issuers</code>.
It should contain Keycloak OpenID Connect discovery document, and the keys.</p>
</blockquote>

<h4 id="summary">Summary</h4>

<p>At this point we have:</p>

<ol>
  <li>Created a Service</li>
  <li>Routed traffic to the service</li>
  <li>Enabled OpenID Connect plugin on the service</li>
</ol>

<p>The following sections will guide you through the process of enabling the OpenID Connect
plugin for specific grants or flows.</p>

<h2 id="authentication">Authentication</h2>

<p>Before you proceed, check that you have done <a href="#preparations">the preparations</a>.</p>

<p>We use <a href="https://httpie.org/" target="_blank" rel="noopener nofollow noreferrer ">HTTPie</a> to execute the examples. The output is stripped
for a better readability. <a href="https://httpbin.org/" target="_blank" rel="noopener nofollow noreferrer ">httpbin.org</a> is used as an upstream service.</p>

<p>Using Admin API is convenient when testing the plugin, but similar configs can
be done in declarative format as well.</p>

<p>When this plugin is configured with multiple grants/flows there is a hard-coded search
order for the credentials:</p>

<ol>
  <li><a href="#session-authentication">Session Authentication</a></li>
  <li><a href="#jwt-access-token-authentication">JWT Access Token Authentication</a></li>
  <li><a href="#kong-oauth-token-authentication">Kong OAuth Token Authentication</a></li>
  <li><a href="#introspection-authentication">Introspection Authentication</a></li>
  <li><a href="#user-info-authentication">User Info Authentication</a></li>
  <li><a href="#refresh-token-grant">Refresh Token Grant</a></li>
  <li><a href="#password-grant">Password Grant</a></li>
  <li><a href="#client-credentials-grant">Client Credentials Grant</a></li>
  <li><a href="#authorization-code-flow">Authorization Code Flow</a></li>
</ol>

<p>Once credentials are found, the plugin will stop searching further. Multiple grants may
share the same credentials. For example, both the password and client credentials grants can use 
basic access authentication through the <code class="language-plaintext highlighter-rouge">Authorization</code> header.</p>

<blockquote class="warning">
  <p>The choices made in the examples below are solely aimed at simplicity.
Because <code class="language-plaintext highlighter-rouge">httpbin.org</code> is used as an upstream service, it is highly recommended that you do
not run these usage examples with a production identity provider as there is a great chance
of leaking information. Also the examples below use the plain HTTP protocol that you should
never use in production.</p>
</blockquote>

<h3 id="authorization-code-flow">Authorization Code Flow</h3>

<p>The authorization code flow is the three-legged OAuth/OpenID Connect flow.
The sequence diagram below describes the participants and their interactions
for this usage scenario, including the use of session cookies:</p>

<p><img src="/assets/images/products/plugins/openid-connect/authorization-code-flow.svg" alt="Authorization code flow diagram"></p>

<blockquote class="note">
  <p>If using PKCE, the identity provider <em>must</em> contain the <code class="language-plaintext highlighter-rouge">code_challenge_methods_supported</code> object in the <code class="language-plaintext highlighter-rouge">/.well-known/openid-configuration</code> issuer discovery endpoint response, as required by <a href="https://www.rfc-editor.org/rfc/rfc8414.html" target="_blank" rel="noopener nofollow noreferrer ">RFC 8414</a>. If it is not included, the PKCE <code class="language-plaintext highlighter-rouge">code_challenge</code> query parameter will not be sent.</p>
</blockquote>

<h4 id="patch-the-plugin">Patch the Plugin</h4>

<p>Letâ€™s patch the plugin that we created in the <a href="#kong-configuration">Kong configuration</a> step:</p>

<ol>
  <li>We want to only use the authorization code flow and the session authentication.</li>
  <li>We want to set the response mode to <code class="language-plaintext highlighter-rouge">form_post</code> so that authorization codes wonâ€™t get logged to the access logs.</li>
  <li>We want to preserve the original request query arguments over the authorization code flow redirection.</li>
  <li>We want to redirect the client to original request url after the authorization code flow so that
the <code class="language-plaintext highlighter-rouge">POST</code> request (because of <code class="language-plaintext highlighter-rouge">form_post</code>) is turned to the <code class="language-plaintext highlighter-rouge">GET</code> request, and the browser address bar is updated
with the original request query arguments.</li>
  <li>We donâ€™t want to include any tokens in the browser address bar.</li>
</ol>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.auth_methods<span class="o">=</span>authorization_code                         <span class="se">\</span>
  config.auth_methods<span class="o">=</span>session                                    <span class="se">\</span>
  config.response_mode<span class="o">=</span>form_post                                 <span class="se">\</span>
  config.preserve_query_args<span class="o">=</span><span class="nb">true</span>                                <span class="se">\</span>
  config.login_action<span class="o">=</span>redirect                                   <span class="se">\</span>
  config.login_tokens<span class="o">=</span>
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"authorization_code"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"session"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"login_action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"redirect"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"preserve_query_args"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"login_tokens"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="test-the-authorization-code-flow">Test the Authorization Code Flow</h4>

<ol>
  <li>Open the Service Page with some query arguments:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>open http://service.test:8000/?hello<span class="o">=</span>world
</code></pre></div>    </div>
    <p><img src="/assets/images/products/plugins/openid-connect/authorization-code-flow-1.png"></p>
  </li>
  <li>See that the browser is redirected to the Keycloak login page:
<br><br>
<img src="/assets/images/products/plugins/openid-connect/authorization-code-flow-2.png">
<br>
    <blockquote>
      <p>You may examine the query arguments passed to Keycloak with the browser developer tools.</p>
    </blockquote>
  </li>
  <li>And finally you will be presented a response from httpbin.org:
<br><br>
<img src="/assets/images/products/plugins/openid-connect/authorization-code-flow-3.png">
</li>
  <li>Done.</li>
</ol>

<p>It looks rather simple from the user point of view, but what really happened is
described in <a href="#authorization-code-flow">the diagram</a> above.</p>

<h3 id="password-grant">Password Grant</h3>

<p>Password grant is a legacy authentication grant. This is a less secure way of
authenticating end users than the authorization code flow, because, for example,
the passwords are shared with third parties. The image below illustrates the grant:</p>

<p><img src="/assets/images/products/plugins/openid-connect/password-grant.svg"></p>

<h4 id="patch-the-plugin-1">Patch the Plugin</h4>

<p>Letâ€™s patch the plugin that we created in the <a href="#kong-configuration">Kong configuration</a> step:</p>

<ol>
  <li>We want to only use the password grant.</li>
  <li>We want to search credentials for password grant from the headers only.</li>
</ol>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.auth_methods<span class="o">=</span>password                                   <span class="se">\</span>
  config.password_param_type<span class="o">=</span>header
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"password"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"password_param_type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"header"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="test-the-password-grant">Test the Password Grant</h4>

<ol>
  <li>Request the service with basic authentication credentials created in the <a href="#keycloak-configuration">Keycloak configuration</a> step:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> <span class="nt">-a</span> john:doe :8000
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Basic BEkg3bHT0ERXFmKr1qelBQYrLBeHb5Hr</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div>    </div>
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;access-token&gt;"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Done.</li>
</ol>

<blockquote>
  <p>If you make another request using the same credentials, you should see that Kong adds less
latency to the request as it has cached the token endpoint call to Keycloak.</p>
</blockquote>

<h3 id="client-credentials-grant">Client Credentials Grant</h3>

<p>The client credentials grant is very similar to <a href="#password-grant">the password grant</a>.
The most important difference in the Kong OpenID Connect plugin is that the plugin itself
does not try to authenticate. It just forwards the credentials passed by the client
to the identity serverâ€™s token endpoint. The client credentials grant is visualized
below:</p>

<p><img src="/assets/images/products/plugins/openid-connect/client-credentials-grant.svg"></p>

<h4 id="patch-the-plugin-2">Patch the Plugin</h4>

<p>Letâ€™s patch the plugin that we created in the <a href="#kong-configuration">Kong configuration</a> step:</p>

<ol>
  <li>We want to only use the client credentials grant.</li>
  <li>We want to search credentials for client credentials from the headers only.</li>
</ol>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.auth_methods<span class="o">=</span>client_credentials                         <span class="se">\</span>
  config.client_credentials_param_type<span class="o">=</span>header
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"client_credentials"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"client_credentials_param_type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"header"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="test-the-client-credentials-grant">Test the Client Credentials Grant</h4>

<ol>
  <li>Request the service with client credentials created in the <a href="#keycloak-configuration">Keycloak configuration</a> step:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> <span class="nt">-a</span> service:cf4c655a-0622-4ce6-a0de-d3353ef0b714 :8000
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Basic c2VydmljZTpjZjRjNjU1YS0wNjIyLTRjZTYtYTBkZS1kMzM1M2VmMGI3MTQ=</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div>    </div>
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;access-token&gt;"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Done.</li>
</ol>

<blockquote>
  <p>If you make another request using the same credentials, you should see that Kong adds less
latency to the request as it has cached the token endpoint call to Keycloak.</p>
</blockquote>

<h3 id="refresh-token-grant">Refresh Token Grant</h3>

<p>The refresh token grant can be used when the client has a refresh token available. There is a caveat
with this: identity providers in general only allow refresh token grant to be executed with the same
client that originally got the refresh token, and if there is a mismatch, it may not work. The mismatch
is likely when Kong OpenID Connect is configured to use one client, and the refresh token is retrieved
with another. The grant itself is very similar to <a href="#password-grant">password grant</a> and
<a href="#client-credentials-grant">client credentials grant</a>:</p>

<p><img src="/assets/images/products/plugins/openid-connect/refresh-token-grant.svg"></p>

<h4 id="patch-the-plugin-3">Patch the Plugin</h4>

<p>Letâ€™s patch the plugin that we created in the <a href="#kong-configuration">Kong configuration</a> step:</p>

<ol>
  <li>We want to only use the refresh token grant, but we also enable <a href="#password-grant">the password grant</a> for demoing purposes</li>
  <li>We want to search the refresh token for the refresh token grant from the headers only.</li>
  <li>We want to pass refresh token from the client in <code class="language-plaintext highlighter-rouge">Refresh-Token</code> header.</li>
  <li>We want to pass refresh token to upstream in <code class="language-plaintext highlighter-rouge">Refresh-Token</code> header.</li>
</ol>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.refresh_token_param_name<span class="o">=</span>refresh_token                  <span class="se">\</span>
  config.refresh_token_param_type<span class="o">=</span>header                         <span class="se">\</span>
  config.auth_methods<span class="o">=</span>refresh_token                              <span class="se">\</span>
  config.auth_methods<span class="o">=</span>password                                   <span class="se">\</span>
  config.upstream_refresh_token_header<span class="o">=</span>refresh_token
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"refresh_token"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"password"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"refresh_token_param_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"refresh_token"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"refresh_token_param_type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"header"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"upstream_refresh_token_header"</span><span class="p">:</span><span class="w"> </span><span class="s2">"refresh_token"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">config.auth_methods</code> and <code class="language-plaintext highlighter-rouge">config.upstream_refresh_token_header</code>
are only enabled for demoing purposes so that we can get a refresh token with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-a</span> john:doe :8000 | jq <span class="nt">-r</span> <span class="s1">'.headers."Refresh-Token"'</span>
</code></pre></div></div>
<p>Output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;refresh-token&gt;
</code></pre></div></div>

<p>We can use the output in <code class="language-plaintext highlighter-rouge">Refresh-Token</code> header.</p>

<h4 id="test-the-refresh-token-grant">Test the Refresh Token Grant</h4>

<ol>
  <li>Request the service with a bearer token:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> :8000 Refresh-Token:<span class="si">$(</span>http <span class="nt">-a</span> john:doe :8000 | <span class="se">\</span>
  jq <span class="nt">-r</span> <span class="s1">'.headers."Refresh-Token"'</span><span class="si">)</span>
</code></pre></div>    </div>
    <p>or</p>
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> :8000 Refresh-Token:<span class="s2">"&lt;refresh-token&gt;"</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Refresh-Token</span><span class="p">:</span> <span class="s">&lt;refresh-token&gt;</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div>    </div>
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;access-token&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Refresh-Token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;refresh-token&gt;"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Done.</li>
</ol>

<h3 id="jwt-access-token-authentication">JWT Access Token Authentication</h3>

<p>For legacy reasons, the stateless <code class="language-plaintext highlighter-rouge">JWT Access Token</code> authentication is named <code class="language-plaintext highlighter-rouge">bearer</code> with the Kong
OpenID Connect plugin (see: <code class="language-plaintext highlighter-rouge">config.auth_methods</code>). Stateless authentication basically means
the signature verification using the identity provider published public keys and the standard
claimsâ€™ verification (such as <code class="language-plaintext highlighter-rouge">exp</code> (or expiry)). The client may have received the token directly
from the identity provider or by other means. It is simple:</p>

<p><img src="/assets/images/products/plugins/openid-connect/bearer-authentication.svg"></p>

<h4 id="patch-the-plugin-4">Patch the Plugin</h4>

<p>Letâ€™s patch the plugin that we created in the <a href="#kong-configuration">Kong configuration</a> step:</p>

<ol>
  <li>We want to only use the bearer authentication, but we also enable <a href="#password-grant">the password grant</a> for demoing purposes</li>
  <li>We want to search the bearer token for the bearer authentication from the headers only.</li>
</ol>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.bearer_token_param_type<span class="o">=</span>header                          <span class="se">\</span>
  config.auth_methods<span class="o">=</span>bearer                                     <span class="se">\</span>
  config.auth_methods<span class="o">=</span>password <span class="c"># only enabled for demoing purposes</span>
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"bearer"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"password"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"bearer_token_param_type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"header"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The <a href="#password-grant">password grant</a> is enabled so that we can get a JWT access token that we can use
to show how the JWT access token authentication works. That is: we need a token. One way to get a JWT access token
is to issue the following call (we use <a href="https://stedolan.github.io/jq/" target="_blank" rel="noopener nofollow noreferrer ">jq</a> to filter the response):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-a</span> john:doe :8000 | jq <span class="nt">-r</span> .headers.Authorization
</code></pre></div></div>
<p>Output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Bearer &lt;access-token&gt;
</code></pre></div></div>

<p>We can use the output in <code class="language-plaintext highlighter-rouge">Authorization</code> header.</p>

<h4 id="test-the-jwt-access-token-authentication">Test the JWT Access Token Authentication</h4>

<ol>
  <li>Request the service with a bearer token:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> :8000 Authorization:<span class="s2">"</span><span class="si">$(</span>http <span class="nt">-a</span> john:doe :8000 | <span class="se">\</span>
  jq <span class="nt">-r</span> .headers.Authorization<span class="si">)</span><span class="s2">"</span>
</code></pre></div>    </div>
    <p>or</p>
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> :8000 Authorization:<span class="s2">"Bearer &lt;access-token&gt;"</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Bearer &lt;access-token&gt;</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div>    </div>
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;access-token&gt;"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Done.</li>
</ol>

<h4 id="test-the-jwt-access-token-authentication-with-access-token-in-query-string">Test the JWT Access Token Authentication with access token in query string</h4>

<p>To specify the bearer token as a query string parameter:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-i</span> <span class="nt">-X</span> PATCH http://localhost:8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9  <span class="se">\</span>
  <span class="nt">--data</span> <span class="s2">"config.bearer_token_param_type=query"</span>                 <span class="se">\</span>
  <span class="nt">--data</span> <span class="s2">"config.auth_methods=bearer"</span>                           <span class="se">\</span>
  <span class="nt">--data</span> <span class="s2">"config.auth_methods=password"</span> <span class="c"># only enabled for demoing purposes</span>
</code></pre></div></div>

<p>Test out the token by accessing the Kong proxy:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl http://localhost:8000?access_token<span class="o">=</span>&lt;token&gt;
</code></pre></div></div>

<h3 id="introspection-authentication">Introspection Authentication</h3>

<p>As with <a href="#jwt-access-token-authentication">JWT Access Token Authentication</a>), the introspection authentication
relies on a bearer token that the client has already gotten from somewhere. The difference to stateless
JWT authentication is that the plugin needs to call the introspection endpoint of the identity provider
to find out whether the token is valid and active. This makes it possible to issue opaque tokens to
the clients.</p>

<p><img src="/assets/images/products/plugins/openid-connect/introspection-authentication.svg"></p>

<h4 id="patch-the-plugin-5">Patch the Plugin</h4>

<p>Letâ€™s patch the plugin that we created in the <a href="#kong-configuration">Kong configuration</a> step:</p>

<ol>
  <li>We want to only use the introspection authentication, but we also enable <a href="#password-grant">the password grant</a> for demoing purposes</li>
  <li>We want to search the bearer token for the introspection from the headers only.</li>
</ol>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.bearer_token_param_type<span class="o">=</span>header                          <span class="se">\</span>
  config.auth_methods<span class="o">=</span>introspection                              <span class="se">\</span>
  config.auth_methods<span class="o">=</span>password <span class="c"># only enabled for demoing purposes</span>
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"introspection"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"password"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"bearer_token_param_type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"header"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="test-the-introspection-authentication">Test the Introspection Authentication</h4>

<ol>
  <li>Request the service with a bearer token:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> :8000 Authorization:<span class="s2">"</span><span class="si">$(</span>http <span class="nt">-a</span> john:doe :8000 | <span class="se">\</span>
  jq <span class="nt">-r</span> .headers.Authorization<span class="si">)</span><span class="s2">"</span>
</code></pre></div>    </div>
    <p>or</p>
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> :8000 Authorization:<span class="s2">"Bearer &lt;access-token&gt;"</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Bearer &lt;access-token&gt;</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div>    </div>
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;access-token&gt;"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Done.</li>
</ol>

<h3 id="user-info-authentication">User Info Authentication</h3>

<p>The user info authentication uses OpenID Connect standard user info endpoint to verify the access token.
In most cases it is preferable to use <a href="#introspection-authentication">Introspection Authentication</a>
as that is meant for retrieving information from the token itself, whereas the user info endpoint is
meant for retrieving information about the user for whom the token was given. The sequence
diagram below looks almost identical to introspection authentication:</p>

<p><img src="/assets/images/products/plugins/openid-connect/userinfo-authentication.svg"></p>

<h4 id="patch-the-plugin-6">Patch the Plugin</h4>

<p>Letâ€™s patch the plugin that we created in the <a href="#kong-configuration">Kong configuration</a> step:</p>

<ol>
  <li>We want to only use the user info authentication, but we also enable <a href="#password-grant">the password grant</a> for demoing purposes</li>
  <li>We want to search the bearer token for the user info from the headers only.</li>
</ol>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.bearer_token_param_type<span class="o">=</span>header                          <span class="se">\</span>
  config.auth_methods<span class="o">=</span>userinfo                                   <span class="se">\</span>
  config.auth_methods<span class="o">=</span>password <span class="c"># only enabled for demoing purposes</span>
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"userinfo"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"password"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"bearer_token_param_type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"header"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="test-the-user-info-authentication">Test the User Info Authentication</h4>

<ol>
  <li>Request the service with a bearer token:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> :8000 Authorization:<span class="s2">"</span><span class="si">$(</span>http <span class="nt">-a</span> john:doe :8000 | <span class="se">\</span>
  jq <span class="nt">-r</span> .headers.Authorization<span class="si">)</span><span class="s2">"</span>
</code></pre></div>    </div>
    <p>or</p>
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> :8000 Authorization:<span class="s2">"Bearer &lt;access-token&gt;"</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Bearer &lt;access-token&gt;</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div>    </div>
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;access-token&gt;"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Done.</li>
</ol>

<h3 id="kong-oauth-token-authentication">Kong OAuth Token Authentication</h3>

<p>The OpenID Connect plugin can also verify the tokens issued by <a href="/hub/kong-inc/oauth2/">Kong OAuth 2.0 Plugin</a>.
This is very similar to third party identity provider issued <a href="#jwt-access-token-authentication">JWT access token authentication</a>
or <a href="#introspection-authentication">introspection authentication</a>:</p>

<p><img src="/assets/images/products/plugins/openid-connect/kong-oauth-authentication.svg"></p>

<h4 id="prepare-kong-oauth-application">Prepare Kong OAuth Application</h4>

<ol>
  <li>Create a Consumer:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> put :8001/consumers/jane
</code></pre></div>    </div>
  </li>
  <li>Create Kong OAuth Application for the consumer:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> put :8001/consumers/jane/oauth2/client <span class="se">\</span>
  <span class="nv">name</span><span class="o">=</span>demo                                    <span class="se">\</span>
  <span class="nv">client_secret</span><span class="o">=</span>secret                         <span class="se">\</span>
  <span class="nv">hash_secret</span><span class="o">=</span><span class="nb">true</span>
</code></pre></div>    </div>
  </li>
  <li>Create a Route:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> put :8001/routes/auth <span class="nv">paths</span><span class="o">=</span>/auth
</code></pre></div>    </div>
  </li>
  <li>Apply OAuth plugin to the Route:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> put :8001/plugins/7cdeaa2d-5faf-416d-8df5-533d1e4cd2c4 <span class="se">\</span>
  <span class="nv">name</span><span class="o">=</span>oauth2                                                  <span class="se">\</span>
  route.name<span class="o">=</span>auth                                              <span class="se">\</span>
  config.global_credentials<span class="o">=</span><span class="nb">true</span>                               <span class="se">\</span>
  config.enable_client_credentials<span class="o">=</span><span class="nb">true</span>
</code></pre></div>    </div>
  </li>
  <li>Test the token endpoint:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>https <span class="nt">-f</span> <span class="nt">--verify</span> no post :8443/auth/oauth2/token <span class="se">\</span>
  <span class="nv">client_id</span><span class="o">=</span>client                                <span class="se">\</span>
  <span class="nv">client_secret</span><span class="o">=</span>secret                            <span class="se">\</span>
  <span class="nv">grant_type</span><span class="o">=</span>client_credentials
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div>    </div>
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;access-token&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">7200</span><span class="p">,</span><span class="w">
    </span><span class="nl">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bearer"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ol>

<p>At this point we should be able to retrieve a new access token with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https <span class="nt">-f</span> <span class="nt">--verify</span> no post :8443/auth/oauth2/token <span class="se">\</span>
  <span class="nv">client_id</span><span class="o">=</span>client                                <span class="se">\</span>
  <span class="nv">client_secret</span><span class="o">=</span>secret                            <span class="se">\</span>
  <span class="nv">grant_type</span><span class="o">=</span>client_credentials |                 <span class="se">\</span>
  jq <span class="nt">-r</span> .access_token
</code></pre></div></div>
<p>Output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;access-token&gt;
</code></pre></div></div>

<h4 id="patch-the-plugin-7">Patch the Plugin</h4>

<p>Letâ€™s patch the plugin that we created in the <a href="#kong-configuration">Kong configuration</a> step:</p>

<ol>
  <li>We want to only use the Kong OAuth authentication</li>
  <li>We want to search the bearer token for the Kong OAuth authentication from the headers only.</li>
</ol>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.auth_methods<span class="o">=</span>kong_oauth2                                <span class="se">\</span>
  config.bearer_token_param_type<span class="o">=</span>header
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"kong_oauth2"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"bearer_token_param_type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"header"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="test-the-kong-oauth-token-authentication">Test the Kong OAuth Token Authentication</h4>

<ol>
  <li>Request the service with Kong OAuth token:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> :8000 Authorization:<span class="s2">"Bearer </span><span class="si">$(</span>https <span class="nt">-f</span> <span class="nt">--verify</span> no <span class="se">\</span>
  post :8443/auth/oauth2/token                             <span class="se">\</span>
  <span class="nv">client_id</span><span class="o">=</span>client                                         <span class="se">\</span>
  <span class="nv">client_secret</span><span class="o">=</span>secret                                     <span class="se">\</span>
  <span class="nv">grant_type</span><span class="o">=</span>client_credentials |                          <span class="se">\</span>
  jq <span class="nt">-r</span> .access_token<span class="si">)</span><span class="s2">"</span>
</code></pre></div>    </div>
    <p>or</p>
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> :8000 Authorization:<span class="s2">"Bearer &lt;access-token&gt;"</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Bearer &lt;access-token&gt;</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div>    </div>
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;access-token&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"X-Consumer-Id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;consumer-id&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"X-Consumer-Username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jane"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Done.</li>
</ol>

<h3 id="session-authentication">Session Authentication</h3>

<p>Kong OpenID Connect plugin can issue a session cookie that can be used for further
session authentication. To make OpenID Connect issue a session cookie, you need
to first authenticate with one of the other grant / flows described above. In
<a href="#authorization-code-flow">authorization code flow</a> we already demonstrated session
authentication when we used the redirect login action. The session authentication
is described below:</p>

<p><img src="/assets/images/products/plugins/openid-connect/session-authentication.svg"></p>

<h4 id="patch-the-plugin-8">Patch the Plugin</h4>

<p>Letâ€™s patch the plugin that we created in the <a href="#kong-configuration">Kong configuration</a> step:</p>

<ol>
  <li>We want to only use the session authentication, but we also enable <a href="#password-grant">the password grant</a> for demoing purposes</li>
</ol>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.auth_methods<span class="o">=</span>session                                    <span class="se">\</span>
  config.auth_methods<span class="o">=</span>password <span class="c"># only enabled for demoing purposes</span>
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"session"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"password"</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="test-the-session-authentication">Test the Session Authentication</h4>

<ol>
  <li>Request the service with basic authentication credentials (created in the <a href="#keycloak-configuration">Keycloak configuration</a> step),
and store the session:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> <span class="nt">-a</span> john:doe <span class="nt">--session</span><span class="o">=</span>john :8000
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Basic BEkg3bHT0ERXFmKr1qelBQYrLBeHb5Hr</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Set-Cookie</span><span class="p">:</span> <span class="s">session=&lt;session-cookie&gt;; Path=/; SameSite=Lax; HttpOnly</span>
</code></pre></div>    </div>
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;access-token&gt;"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Make request with a session cookie (stored above):
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> <span class="nt">--session</span><span class="o">=</span>john :8000
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">session=&lt;session-cookie&gt;</span>
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div>    </div>
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;access-token&gt;"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Done.</li>
</ol>

<blockquote>
  <p>If you want to disable session creation with some grants, you can use the <code class="language-plaintext highlighter-rouge">config.disable_session</code>.</p>
</blockquote>

<h2 id="authorization">Authorization</h2>

<p>Before you proceed, check that you have completed <a href="#preparations">the preparations</a>.</p>

<p>The OpenID Connect plugin has several features to do coarse grained authorization:</p>

<ol>
  <li><a href="#claims-based-authorization">Claims based authorization</a></li>
  <li><a href="#acl-plugin-authorization">ACL plugin authorization</a></li>
  <li><a href="#consumer-authorization">Consumer authorization</a></li>
</ol>

<h3 id="claims-based-authorization">Claims Based Authorization</h3>

<p>The following options can be configured to manage claims verification during authorization:</p>

<ol>
  <li>
<code class="language-plaintext highlighter-rouge">config.scopes_claim</code> and <code class="language-plaintext highlighter-rouge">config.scopes_required</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">config.audience_claim</code> and <code class="language-plaintext highlighter-rouge">config.audience_required</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">config.groups_claim</code> and <code class="language-plaintext highlighter-rouge">config.groups_required</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">config.roles_claim</code> and <code class="language-plaintext highlighter-rouge">config.roles_required</code>
</li>
</ol>

<p>For example, the first configuration option, <code class="language-plaintext highlighter-rouge">config.scopes_claim</code>, points to a source, from which the value is
retrieved and checked against the value of the second configuration option: <code class="language-plaintext highlighter-rouge">config.scopes_required</code>.</p>

<p>Letâ€™s take a look at a JWT access token:</p>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<ol>
  <li>Patch the plugin to enable the password grant:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.auth_methods<span class="o">=</span>password
</code></pre></div>    </div>
  </li>
  <li>Retrieve the content of an access token:
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>http <span class="nt">-a</span> john:doe :8000 | jq <span class="nt">-r</span> .headers.Authorization
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div>    </div>
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>Bearer &lt;access-token&gt;
</code></pre></div>    </div>
  </li>
  <li>The signed JWT <code class="language-plaintext highlighter-rouge">&lt;access-token&gt;</code> (JWS) comes with three parts separated with a dot <code class="language-plaintext highlighter-rouge">.</code>:
<code class="language-plaintext highlighter-rouge">&lt;header&gt;.&lt;payload&gt;.&lt;signature&gt;</code> (a JWS compact serialization format)</li>
  <li>We are interested with the <code class="language-plaintext highlighter-rouge">&lt;payload&gt;</code>, and you should have something similar to:
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>eyJleHAiOjE2MjI1NTY3MTMsImF1ZCI6ImFjY291bnQiLCJ0eXAiOiJCZWFyZXIiLC
JzY29wZSI6Im9wZW5pZCBlbWFpbCBwcm9maWxlIiwicHJlZmVycmVkX3VzZXJuYW1l
Ijoiam9obiIsImdpdmVuX25hbWUiOiJKb2huIiwiZmFtaWx5X25hbWUiOiJEb2UifQ
</code></pre></div>    </div>
    <p>That can be base64 url decoded to the following <code class="language-plaintext highlighter-rouge">JSON</code>:</p>
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"exp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1622556713</span><span class="p">,</span><span class="w">
    </span><span class="nl">"aud"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"typ"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid email profile"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"preferred_username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"john"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"given_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"family_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
    <p>This payload may contain arbitrary claims, such as user roles and groups,
but as we didnâ€™t configure them in Keycloak, letâ€™s just use the claims that
we have. In this case we want to authorize against the values in <code class="language-plaintext highlighter-rouge">scope</code> claim.</p>
  </li>
</ol>

<p>Letâ€™s patch the plugin that we created in the <a href="#kong-configuration">Kong configuration</a> step:</p>

<ol>
  <li>We want to only use the password grant for demonstration purposes.</li>
  <li>We require the value <code class="language-plaintext highlighter-rouge">openid</code> and <code class="language-plaintext highlighter-rouge">email</code> to be present in <code class="language-plaintext highlighter-rouge">scope</code> claim of
the access token.</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.auth_methods<span class="o">=</span>password                                   <span class="se">\</span>
  config.scopes_claim<span class="o">=</span>scope                                      <span class="se">\</span>
  config.scopes_required<span class="o">=</span><span class="s2">"openid email"</span>
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"password"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"scopes_claim"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"scope"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"scopes_required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"openid email"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Now letâ€™s see if we can still access the service:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> <span class="nt">-a</span> john:doe :8000
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Basic BEkg3bHT0ERXFmKr1qelBQYrLBeHb5Hr</span>
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;access-token&gt;"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Works as expected, but letâ€™s try to add another authorization:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.audience_claim<span class="o">=</span>aud                                      <span class="se">\</span>
  config.audience_required<span class="o">=</span>httpbin
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"password"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"audience_claim"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"scope"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"audience_required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"httpbin"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>As we know, the access token has <code class="language-plaintext highlighter-rouge">"aud": "account"</code>, and that does not match with <code class="language-plaintext highlighter-rouge">"httpbin"</code>, so
the request should now be forbidden:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> <span class="nt">-a</span> john:doe :8000
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">403</span> <span class="ne">Forbidden</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Forbidden"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A few words about <code class="language-plaintext highlighter-rouge">config.scopes_claim</code> and <code class="language-plaintext highlighter-rouge">config.scopes_required</code> (and the similar configuration options).
You may have noticed that <code class="language-plaintext highlighter-rouge">config.scopes_claim</code> is an array of string elements. Why? It is used to traverse
the JSON when looking up a claim, take for example this imaginary payload:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"user"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"john"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"groups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"employee"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"marketing"</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>In this case you would probably want to use <code class="language-plaintext highlighter-rouge">config.groups_claim</code> to point to <code class="language-plaintext highlighter-rouge">groups</code> claim, but that claim
is not a top-level claim, so you need to traverse there:</p>

<ol>
  <li>Find the <code class="language-plaintext highlighter-rouge">user</code> claim.</li>
  <li>Inside the <code class="language-plaintext highlighter-rouge">user</code> claim, find the <code class="language-plaintext highlighter-rouge">groups</code> claim, and read its value:</li>
</ol>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"groups_claim"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"user"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"groups"</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>or</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.groups_claim<span class="o">=</span>user                                       <span class="se">\</span>
  config.groups_claim<span class="o">=</span><span class="nb">groups</span>
</code></pre></div></div>

<p>The value of a claim can be the following:</p>

<ul>
  <li>a space separated string (such as <code class="language-plaintext highlighter-rouge">scope</code> claim usually is)</li>
  <li>an JSON array of strings (such as the imaginary <code class="language-plaintext highlighter-rouge">groups</code> claim above)</li>
  <li>a simple value, such as a <code class="language-plaintext highlighter-rouge">string</code>
</li>
</ul>

<p>What about the <code class="language-plaintext highlighter-rouge">config.groups_required</code> then? That is also an array?</p>

<p>That is correct, the required checks are arrays to allow logical <code class="language-plaintext highlighter-rouge">and</code>/<code class="language-plaintext highlighter-rouge">or</code> type of checks:</p>

<ol>
  <li>
<code class="language-plaintext highlighter-rouge">and</code>: use a space separated values</li>
  <li>
<code class="language-plaintext highlighter-rouge">or</code>: specify value(s) in separate array indices</li>
</ol>

<p>For example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"groups_required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"employee marketing"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"super-admins"</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>or</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.groups_required<span class="o">=</span><span class="s2">"employee marketing"</span>                    <span class="se">\</span>
  config.groups_required<span class="o">=</span><span class="s2">"super-admins"</span>
</code></pre></div></div>

<p>The above means that a claim has to have:</p>
<ol>
  <li>
<code class="language-plaintext highlighter-rouge">employee</code> <strong>and</strong> <code class="language-plaintext highlighter-rouge">marketing</code> values in it, <strong>OR</strong>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">super-admins</code> value in it</li>
</ol>

<h3 id="acl-plugin-authorization">ACL Plugin Authorization</h3>

<p>The plugin can also be integrated with <a href="/hub/kong-inc/acl/">Kong ACL Plugin</a> that provides
access control functionality in form of allow and deny lists.</p>

<p>Please read <a href="#claims-verification">the claims verification</a> section for a basic information,
as a lot of that applies here too.</p>

<p>Letâ€™s first configure the OpenID Connect plugin for integration with the ACL plugin
(please remove other authorization if enabled):</p>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.auth_methods<span class="o">=</span>password                                   <span class="se">\</span>
  config.authenticated_groups_claim<span class="o">=</span>scope
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"password"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"authorized_groups_claim"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"scope"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Before we apply the ACL plugin, letâ€™s try it once:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> <span class="nt">-a</span> john:doe :8000
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"X-Authenticated-Groups"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid, email, profile"</span><span class="p">,</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Interesting, the <code class="language-plaintext highlighter-rouge">X-Authenticated-Groups</code> header was injected in a request.
This means that we are all good to add the ACL plugin:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> put :8001/plugins/b238b64a-8520-4bbb-b5ff-2972165cf3a2 <span class="se">\</span>
  <span class="nv">name</span><span class="o">=</span>acl                                                     <span class="se">\</span>
  service.name<span class="o">=</span>openid-connect                                  <span class="se">\</span>
  config.allow<span class="o">=</span>openid
</code></pre></div></div>

<p>Letâ€™s test it again:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> <span class="nt">-a</span> john:doe :8000
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>

<p>Letâ€™s make it forbidden by changing it to a deny-list:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/b238b64a-8520-4bbb-b5ff-2972165cf3a2 <span class="se">\</span>
  config.allow<span class="o">=</span>                                                  <span class="se">\</span>
  config.deny<span class="o">=</span>profile
</code></pre></div></div>

<p>And try again:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-v</span> <span class="nt">-a</span> john:doe :8000
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">403</span> <span class="ne">Forbidden</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"You cannot consume this service"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="consumer-authorization">Consumer Authorization</h3>

<p>The third option for authorization is to use Kong consumers and dynamically map
from a claim value to a Kong consumer. This means that we restrict the access to
only those that do have a matching Kong consumer. Kong consumers can have ACL
groups attached to them and be further authorized with the
<a href="/hub/kong-inc/acl/">Kong ACL Plugin</a>.</p>

<p>As a remainder our token payload looks like this:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"exp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1622556713</span><span class="p">,</span><span class="w">
   </span><span class="nl">"aud"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"typ"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid email profile"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"preferred_username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"john"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"given_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"family_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Out of these the <code class="language-plaintext highlighter-rouge">preferred_username</code> claim looks promising for consumer mapping.
Letâ€™s patch the plugin:</p>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.auth_methods<span class="o">=</span>password                                   <span class="se">\</span>
  config.consumer_claim<span class="o">=</span>preferred_username                       <span class="se">\</span>
  config.consumer_by<span class="o">=</span>username
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"password"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"consumer_claim"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"preferred_username"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"consumer_by"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"username"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Before we proceed, letâ€™s make sure we donâ€™t have consumer <code class="language-plaintext highlighter-rouge">john</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http delete :8001/consumers/john
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</code></pre></div></div>

<p>Letâ€™s try to access the service without a matching consumer:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-a</span> john:doe :8000
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">403</span> <span class="ne">Forbidden</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Forbidden"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Now, letâ€™s add the consumer:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> put :8001/consumers/john
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;consumer-id&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"john"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Letâ€™s try to access the service again:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-a</span> john:doe :8000
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;access-token&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"X-Consumer-Id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;consumer-id&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"X-Consumer-Username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"john"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Nice, as you can see the plugin even added the <code class="language-plaintext highlighter-rouge">X-Consumer-Id</code> and <code class="language-plaintext highlighter-rouge">X-Consumer-Username</code> as request headers.</p>

<blockquote>
  <p>It is possible to make consumer mapping optional and non-authorizing by setting the <code class="language-plaintext highlighter-rouge">config.consumer_optional=true</code>.</p>
</blockquote>

<h2 id="headers">Headers</h2>

<p>Before you proceed, check that you have completed <a href="#preparations">the preparations</a>.</p>

<p>The OpenID Connect plugin can pass claim values, tokens, JWKs, and the session identifier to the upstream service
in request headers, and to the downstream client in response headers. By default, the plugin passes an access token
in <code class="language-plaintext highlighter-rouge">Authorization: Bearer &lt;access-token&gt;</code> header to the upstream service (this can be controlled with
<code class="language-plaintext highlighter-rouge">config.upstream_access_token_header</code>). The claim values can be taken from:</p>
<ul>
  <li>an access token,</li>
  <li>an id token,</li>
  <li>an introspection response, or</li>
  <li>a user info response</li>
</ul>

<p>Letâ€™s take a look for an access token payload:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"exp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1622556713</span><span class="p">,</span><span class="w">
   </span><span class="nl">"aud"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"typ"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid email profile"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"preferred_username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"john"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"given_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"family_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>To pass the <code class="language-plaintext highlighter-rouge">preferred_username</code> claimâ€™s value <code class="language-plaintext highlighter-rouge">john</code> to the upstream with an <code class="language-plaintext highlighter-rouge">Authenticated-User</code> header,
we need to patch our plugin:</p>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.auth_methods<span class="o">=</span>password                                   <span class="se">\</span>
  config.upstream_headers_claims<span class="o">=</span>preferred_username              <span class="se">\</span>
  config.upstream_headers_names<span class="o">=</span>authenticated_user
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"password"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"upstream_headers_claims"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"preferred_username"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"upstream_headers_names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"authenticated_user"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Letâ€™s see if it had any effect:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-a</span> john:doe :8000
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;access-token&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Authenticated-User"</span><span class="p">:</span><span class="w"> </span><span class="s2">"john"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>See the <a href="#parameters">configuration parameters</a> for other options.</p>

<h2 id="logout">Logout</h2>

<p>The logout functionality is mostly useful together with <a href="#session-authentication">session authentication</a>
that is mostly useful with <a href="#authorization-code-flow">authorization code flow</a>.</p>

<p>As part of the logout, the OpenID Connect plugin implements several features:</p>

<ul>
  <li>session invalidation</li>
  <li>token revocation</li>
  <li>relying party (RP) initiated logout</li>
</ul>

<p>Letâ€™s patch the OpenID Connect plugin to provide the logout functionality:</p>

<p><a href="#create-a-plugin">Reset the plugin configuration</a> before patching.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-f</span> patch :8001/plugins/5f35b796-ced6-4c00-9b2a-90eef745f4f9 <span class="se">\</span>
  config.auth_methods<span class="o">=</span>session                                    <span class="se">\</span>
  config.auth_methods<span class="o">=</span>password                                   <span class="se">\</span>
  config.logout_uri_suffix<span class="o">=</span>/logout                               <span class="se">\</span>
  config.logout_methods<span class="o">=</span>POST                                     <span class="se">\</span>
  config.logout_revoke<span class="o">=</span><span class="nb">true</span>
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5f35b796-ced6-4c00-9b2a-90eef745f4f9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid-connect"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5fa9e468-0007-4d7e-9aeb-49ca9edd6ccd"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w"> </span><span class="s2">"session"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"logout_uri_suffix"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/logout"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"logout_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"POST"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"logout_revoke"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Login and establish a session:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">-a</span> john:doe <span class="nt">--session</span><span class="o">=</span>john :8000
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>

<p>Test that session authentication works:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">--session</span><span class="o">=</span>john :8000
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>

<p>Logout, and follow the redirect:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">--session</span><span class="o">=</span>john <span class="nt">--follow</span> <span class="nt">-a</span> john: post :8000/logout
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</code></pre></div></div>

<blockquote>
  <p>We needed to pass <code class="language-plaintext highlighter-rouge">-a john:</code> as there seems to be a feature with <code class="language-plaintext highlighter-rouge">HTTPie</code>
that makes it to store the original basic authentication credentials in
a session - not just the session cookies.</p>
</blockquote>

<p>At this point the client has logged out from both Kong and the identity provider (Keycloak).</p>

<p>Check that the session is really gone:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http <span class="nt">--session</span><span class="o">=</span>john :8000
</code></pre></div></div>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">401</span> <span class="ne">Unauthorized</span>
</code></pre></div></div>

<h2 id="debugging">Debugging</h2>

<p>The OpenID Connect plugin is complex, integrating with third-party identity providers can present challenges. If you have
issues with the plugin or integration, try the following:</p>

<ol>
  <li>Set Kong <a href="/gateway/latest/reference/configuration/#log_level">log level</a> to <code class="language-plaintext highlighter-rouge">debug</code>, and check the Kong <code class="language-plaintext highlighter-rouge">error.log</code> (you can filter it with <code class="language-plaintext highlighter-rouge">openid-connect</code>)
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">KONG_LOG_LEVEL</span><span class="o">=</span>debug kong restart
</code></pre></div>    </div>
  </li>
  <li>Set the Kong OpenID Connect plugin to display errors:
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"display_errors"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Disable the Kong OpenID Connect plugin verifications and see if you get further, just for debugging purposes:
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"verify_nonce"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"verify_claims"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"verify_signature"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>See what kind of tokens the Kong OpenID Connect plugin gets:
    <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"login_action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"response"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"login_tokens"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"tokens"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"login_methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"password"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"client_credentials"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"authorization_code"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"bearer"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"introspection"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"userinfo"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"kong_oauth2"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"refresh_token"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"session"</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ol>

<p>With session related issues, you can try to store the session data in <code class="language-plaintext highlighter-rouge">Redis</code> or <code class="language-plaintext highlighter-rouge">memcache</code> as that will make the session
cookie much smaller. It is rather common that big cookies do cause issues. You can also enable session
compression.</p>

<p>Also try to eliminate indirection as that makes it easier to find out where the problem is. By indirection, we
mean other gateways, load balancers, NATs, and such in front of Kong. If there is such, you may look at using:</p>

<ul>
  <li><a href="/gateway/latest/reference/configuration/#port_maps">port maps</a></li>
  <li>
<code class="language-plaintext highlighter-rouge">X-Forwarded-*</code> headers</li>
</ul>







    
          
  <div class="book-nav-container">
    <hr>
    
    
      <div class="book-nav next">
        <span class="direction">Next</span>
        <a href="/hub/kong-inc/openid-connect/3.2.x/configuration/">OpenID Connect Configuration</a>
      </div>
    
  </div>


        </div>
      </div>
    </div>
  </div>
  <div id="scroll-to-top-button">
    <i class="fas fa-chevron-up"></i>
  </div>
  
    <div class="feedback-widget-container">
  <input id="feedback-widget-checkbox" type="checkbox">
  <label for="feedback-widget-checkbox">
    <img src="/assets/images/icons/feedback-widget.svg" alt="Feedback widget">
  </label>
  <div class="feedback-container">
    <div class="feedback-thankyou">
      Thank you for your feedback.
    </div>
    <div class="feedback-comment">
      <textarea id="feedback-comment-text" rows="3" placeholder="Please let us know what we can improve on this page..."></textarea>
      <div class="feedback-comment-buttons">
        <button id="feedback-comment-button-back">Back</button>
        <button id="feedback-comment-button-submit" class="button-primary">Submit</button>
      </div>
    </div>
    <div class="feedback-options">
      <div class="feedback-options-title">Was this page useful?</div>
      <div class="feedback-options-buttons">
        <i data-feedback-result="yes" class="feedback-options-button far fa-thumbs-up"></i>
        <i data-feedback-result="no" class="feedback-options-button far fa-thumbs-down"></i>
      </div>
    </div>
  </div>
</div>

  
</div>

<div id="image-modal" data-image-expand-disabled="">
  <div class="image-modal-backdrop"></div>
  <div class="image-container">
    <img src="" alt="">
    <i class="fa fa-times"></i>
  </div>
</div>


<!-- <script>
/* eslint-disable */
  window.intercomSettings = {
    app_id: "gwoi3d8y"
  };
</script>

<script>
/* eslint-disable */
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',intercomSettings);}else{var d=document;var i=function(){i.c(arguments)};i.q=[];i.c=function(args){i.q.push(args)};w.Intercom=i;function l(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/gwoi3d8y';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})()
</script>
 -->


    <footer class="marketing-footer--light-gray">
  <section>
    <ul class="newsletter">
      <li class="logo-wrapper">
        <div class="logo">
          <img src="/assets/images/logos/kong-logo-blue.svg" alt="Kong">
        </div>
        <div class="footer-title">Powering the API world</div>
        <p>
          Increase developer productivity, security, and performance at scale with the unified platform for API management, service mesh, and ingress controller.
        </p>
        <div class="footer-form-container">
          <form id="subscribe-form" method="POST" action="/assets/javascripts/subscribe.js">
            <input required id="subscribe-input" type="email" name="email" placeholder="Email" aria-required="true" aria-invalid="false">
            <input id="footer-form-button" type="submit" form="subscribe-form" value="Subscribe">
          </form>

          <div id="form-response"></div>
        </div>
      </li>

      <li class="footer-columns">
        <ul class="footer-columns-product-list">
          <li>
            <nav>
              <div class="footer-category">Products</div>
              <ul>
                <li>
                  <a href="https://konghq.com/products/kong-konnect" target="_blank" rel="noopener nofollow noreferrer ">Kong Konnect</a>
                </li>
                <li>
                  <a href="https://konghq.com/products/kong-enterprise" target="_blank" rel="noopener nofollow noreferrer ">Kong Gateway Enterprise</a>
                </li>
                <li>
                  <a href="https://konghq.com/products/kong-gateway" target="_blank" rel="noopener nofollow noreferrer ">Kong Gateway</a>
                </li>
                <li>
                  <a href="https://konghq.com/products/kong-mesh" target="_blank" rel="noopener nofollow noreferrer ">Kong Mesh</a>
                </li>
                <li>
                  <a href="https://konghq.com/products/kong-ingress-controller" target="_blank" rel="noopener nofollow noreferrer ">Kong Ingress Controller</a>
                </li>
                <li>
                  <a href="https://insomnia.rest/" target="_blank" rel="noopener nofollow noreferrer noopener nofollow noreferrer">Kong Insomnia</a>
                </li>
                <li>
                  <a href="https://konghq.com/product-updates" target="_blank" rel="noopener nofollow noreferrer ">Product Updates</a>
                </li>
                <li>
                  <a href="https://konghq.com/contact-sales" target="_blank" rel="noopener nofollow noreferrer ">Get Started</a>
                </li>
              </ul>
            </nav>
          </li>
          <li>
            <nav>
              <div class="footer-category">Documentation</div>
              <ul>
                <li>
                  <a href="/konnect/">Kong Konnect Docs</a>
                </li>
                <li>
                  <a href="/gateway/latest/">Kong Gateway Docs</a>
                </li>
                <li>
                  <a href="/gateway/latest/kong-enterprise/">Kong Gateway Enterprise Docs</a>
                </li>
                <li>
                  <a href="/mesh/latest/">Kong Mesh Docs</a>
                </li>
                <li>
                  <a href="https://docs.insomnia.rest/" target="_blank" rel="noopener nofollow noreferrer noopener nofollow noreferrer">Kong Insomnia Docs</a>
                </li>
                <li>
                  <a href="/hub/">Kong Konnect Plugin Hub</a>
                </li>
              </ul>
            </nav>
          </li>
          <li>
            <nav>
              <div class="footer-category">Open Source</div>
              <ul>
                <li>
                  <a href="https://konghq.com/install/#kong-community" target="_blank" rel="noopener nofollow noreferrer ">Kong Gateway</a>
                </li>
                <li>
                  <a href="https://kuma.io/" target="_blank" rel="noopener nofollow noreferrer noopener nofollow noreferrer">Kuma</a>
                </li>
                <li>
                  <a href="https://insomnia.rest/" target="_blank" rel="noopener nofollow noreferrer noopener nofollow noreferrer">Insomnia</a>
                </li>
                <li>
                  <a href="https://konghq.com/community" target="_blank" rel="noopener nofollow noreferrer ">Kong Community</a>
                </li>
              </ul>
            </nav>
          </li>
          <li>
            <nav>
              <div class="footer-category">Company</div>
              <ul>
                <li>
                  <a href="https://konghq.com/company/about-us" target="_blank" rel="noopener nofollow noreferrer ">About Kong</a>
                </li>
                <li>
                  <a href="https://konghq.com/customers" target="_blank" rel="noopener nofollow noreferrer ">Customers</a>
                </li>
                <li>
                  <a href="https://konghq.com/company/careers" target="_blank" rel="noopener nofollow noreferrer ">Careers</a>
                </li>
                <li>
                  <a href="https://konghq.com/press-room" target="_blank" rel="noopener nofollow noreferrer ">Press</a>
                </li>
                <li>
                  <a href="https://konghq.com/events" target="_blank" rel="noopener nofollow noreferrer ">Events</a>
                </li>
                <li>
                  <a href="https://konghq.com/company/contact-us" target="_blank" rel="noopener nofollow noreferrer ">Contact</a>
                </li>
              </ul>
            </nav>
          </li>
        </ul>
      </li>

    </ul>
  </section>

  <section class="legal">
    <div class="container d-flex">
      <div class="social">
        <div class="social-link">
          <a href="https://www.facebook.com/konghq/" title="Facebook" target="_blank" rel="noopener nofollow noreferrer "><i aria-label="Facebook" class="fa fa-facebook-official" aria-hidden="true"></i></a>
        </div>
        <div class="social-link">
          <a href="https://twitter.com/thekonginc" title="Twitter" target="_blank" rel="noopener nofollow noreferrer "><i aria-label="Twitter" class="fa fa-twitter" aria-hidden="true"></i></a>
        </div>
        <div class="social-link">
          <a href="https://www.meetup.com/topics/kong/all/" title="Meetup" target="_blank" rel="noopener nofollow noreferrer "><i aria-label="Meetup" class="fa fa-meetup" aria-hidden="true"></i></a>
        </div>
        <div class="social-link">
          <a href="https://linkedin.com/company/278819" title="LinkedIn" target="_blank" rel="noopener nofollow noreferrer "><i aria-label="GitHub" class="fa fa-linkedin" aria-hidden="true"></i></a>
        </div>
        <div class="social-link">
          <a href="https://github.com/kong/kong" target="_blank" class="btn-gh" title="GitHub" rel="noopener nofollow noreferrer ">
            <i class="fa fa-github" aria-hidden="true" aria-label="GitHub"></i>
          </a>
        </div>
      </div>
      <ul>
        <li>
          <span class="mashape-footer-content">
            <a href="https://konghq.com/terms" target="_blank" rel="noopener nofollow noreferrer ">Terms</a><b>â€¢</b>
            <a href="https://konghq.com/privacy" target="_blank" rel="noopener nofollow noreferrer ">Privacy</a><b>â€¢</b>
            <a href="https://konghq.com/compliance" target="_blank" rel="noopener nofollow noreferrer ">Trust and Compliance</a>
          </span>
        </li>
      </ul>
      <div>
        <span>Â© Kong Inc. 2024 Â </span>
      </div>
    </div>
  </section>

  <script type="text/javascript">
    function onSubmit(response) {
      document.getElementById("subscription_form").submit();
      document.getElementById("follow_up_subscription_form").submit();
      if (response.length == 0) {
        alert("reCaptcha verification failed");
      }
    }
  </script>
</footer>
 <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<i class=\"fa fa-link\"></i>";
    anchor.title = `${id} Permalink`;
    return anchor;
  };

  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var className =
        ".show-anchor-links h1, .show-anchor-links h2, .show-anchor-links h3, " +
        ".show-anchor-links h4, .show-anchor-links h5, .show-anchor-links h6";
      var headers = document.querySelectorAll(className);

      for (var i = 0; i < headers.length; i++) {
        var header = headers[i];
        if (typeof header.id !== "undefined" && header.id !== "") {
          header.prepend(anchorForId(header.id));
        }
      }
    }
  };
</script>


    
      <script>
        (function stp(){
          if (typeof analytics == "undefined"){
            return setTimeout(stp, 30);
          }
          analytics.page();
        })();
      </script>
    

    <div id="fb-root"></div>
    <script id="github-bjs" src="https://buttons.github.io/buttons.js" async defer></script>

    <script type="text/javascript">
      var _vwo_code = (function() {
        var account_id = 125292,
          settings_tolerance = 2000,
          library_tolerance = 2500,
          use_existing_jquery = true,
          // DO NOT EDIT BELOW THIS LINE
          f = false,
          d = document;
        return {
          use_existing_jquery: function() {
            return use_existing_jquery;
          },
          library_tolerance: function() {
            return library_tolerance;
          },
          finish: function() {
            if (!f) {
              f = true;
              var a = d.getElementById('_vis_opt_path_hides');
              if (a) a.parentNode.removeChild(a);
            }
          },
          finished: function() {
            return f;
          },
          load: function(a) {
            var b = d.createElement('script');
            b.src = a;
            b.type = 'text/javascript';
            b.innerText;
            b.onerror = function() {
              _vwo_code.finish();
            };
            d.getElementsByTagName('head')[0].appendChild(b);
          },
          init: function() {
            settings_timer = setTimeout(
              '_vwo_code.finish()',
              settings_tolerance
            );
            this.load(
              '//dev.visualwebsiteoptimizer.com/j.php?a=' +
                account_id +
                '&u=' +
                encodeURIComponent(d.URL) +
                '&r=' +
                Math.random()
            );
            var a = d.createElement('style'),
              b = '',
              h = d.getElementsByTagName('head')[0];
            a.setAttribute('id', '_vis_opt_path_hides');
            a.setAttribute('type', 'text/css');
            if (a.styleSheet) a.styleSheet.cssText = b;
            else a.appendChild(d.createTextNode(b));
            h.appendChild(a);
            return settings_timer;
          }
        };
      })();
      _vwo_settings_timer = _vwo_code.init();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>

    
      <script type="text/javascript">
        docsearch({
          appId: '05Y6TLHNFZ',
          apiKey: '80483bfe28d9fd036a11a6f6a06454f8',
          indexName: 'konghq',
          container: '#getkong-algolia-search-input',
          disableUserPersonalization: true,
          placeholder: 'Search the docs...',
          // Override selected event to allow for local environment navigation
          transformItems(items) {
            return items.map((item) => {
              var modifiedUrl = window.location.protocol + '//' + window.location.host + item.url.split('docs.konghq.com')[1];
              return { ...item, url: modifiedUrl };
            });
          },
          translations: {
            button: {
              buttonText: 'Search the docs..',
              buttonAriaLabel: 'Search the docs...'
            }
          },
          resultsFooterComponent({ state }) {
            var facetParameters = {};
            
              facetParameters = {"version[0]":"3.2.x","product[0]":"Plugin Hub"};
            

            var queryParams = new URLSearchParams(facetParameters);
            queryParams.set('query', state.query);

            return {
              // The HTML `tag`
              type: 'a',
              ref: undefined,
              constructor: undefined,
              key: state.query,
              // Its props
              props: {
                href: `/search/?${queryParams.toString()}`,
                target: '_blank',
                // Raw text rendered in the HTML element
                children: 'See more >'
              },
              __v: null,
            };
          },
          
           searchParameters: {
              optionalFilters: ['product:Kong Konnect<score=1>', 'product:Kong Gateway<score=2>', 'product:Plugin Hub<score=3>'],
              facetFilters: [ 'version:3.2.x']
            }
            
          });
      </script>
    
  </body>

  

</html>

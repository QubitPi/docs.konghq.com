<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Article">

  



<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
    <!-- OneTrust Cookies Consent Notice start for konghq.com -->
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" type="text/javascript" charset="UTF-8" data-domain-script="2c4de954-6bec-4e93-8086-64cb113f151a">
    </script>
    <script type="text/javascript">
    function OptanonWrapper() { }
    </script>
    <!-- OneTrust Cookies Consent Notice end for konghq.com -->

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NL48VKT');</script>
    <!-- End Google Tag Manager -->

    <!-- Recaptcha -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Plugin Development - Storing Custom Entities - v2.7.x | Kong Docs</title>
  <meta name="description" content="Documentation for Kong, the Cloud Connectivity Company for APIs and Microservices.">
  <meta name="author" content="KongHQ">
  <meta property="og:title" content="Plugin Development - Storing Custom Entities - v2.7.x | Kong Docs">
  <meta property="og:site_name" content="Kong Docs">
  <!-- use share link for facebook -->
  <meta property="og:url" content="https://docs.konghq.com">
  <meta property="og:description" content="Documentation for Kong, the Cloud Connectivity Company for APIs and Microservices.">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="en_US">
  <meta property="og:image" content="https://docs.konghq.com/assets/images/share.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@thekonginc">
  <meta name="twitter:creator" content="@thekonginc">
  <meta name="twitter:url" content="https://docs.konghq.com">
  <meta name="twitter:description" content="Documentation for Kong, the Cloud Connectivity Company for APIs and Microservices.">
  <meta name="twitter:image" content="https://docs.konghq.com/assets/images/share.png">
  <meta property="fb:admins" content="227304446">
  <meta property="fb:admins" content="576641408">
  <meta name="google-site-verification" content="CrU3zp02dNKTe8NSAipL4NCPkrIjDXG8fViTZ-MIzP4">

  

  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "name": "KongHQ",
      "url": "https://docs.konghq.com",
      "logo": "https://docs.konghq.com/assets/images/logo.png",
      "sameAs": [
        "https://www.facebook.com/konginc",
        "https://twitter.com/thekonginc",
        "https://plus.google.com/+mashape"
      ]
    }
  </script>

  <!-- Preload assets -->
  <link rel="dns-prefetch" href="https://cloud.typography.com">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
  <link rel="dns-prefetch" href="https://dev.visualwebsiteoptimizer.com">
  <link rel="dns-prefetch" href="https://cdn.segment.com">

  <link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">

  
    <link rel="canonical" href="https://docs.konghq.com/gateway/latest/plugin-development/custom-entities/">
  

  
    <meta name="robots" content="follow,noindex">
  

  <!-- FontAwesome icon font -->
  <script src="https://kit.fontawesome.com/1332a92967.js" crossorigin="anonymous">
  </script>

  
  <script src="/docs.konghq.com/vite/assets/application-MBEAZv6G.js" crossorigin="anonymous" type="module"></script>
<link href="/docs.konghq.com/vite/assets/_commonjsHelpers-4gQjN7DL.js" rel="modulepreload" as="script" crossorigin="anonymous">


  

  

  <link rel="stylesheet" href="/docs.konghq.com/vite/assets/application-T5YiCv-Y.css" media="screen">

  
</head>


  <body id="" data-spy="scroll" data-target="#scroll-sidebar" data-offset="350">

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NL48VKT" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <header class="navbar-v2 closed">
  <a class="skip-main" href="#main">Skip to content</a>
  <!-- uncomment the promo-banner div when adding a new promo banner-->
  <!--also uncomment the promo banner sections in app/assets/stylesheets/header.less and application.js-->
  <!-- <div id="promo-banner">
    <div class="container">
      <div class="closebanner"></div> <strong>2023 API Summit Hackathon: Experiment with AI for APIs (August 28 - September 27) <a
          href="https://konghq.com/conferences/kong-summit/hackathon?utm_medium=website&utm_source=docs-konghq-com&utm_campaign=docs-banner">Learn More &rarr;</a></strong>
    </div>
  </div> -->
  <div class="navbar-content">
    <a href="https://konghq.com" class="navbar-brand col col-xl-auto" target="_blank" rel="noopener noreferrer">
      <img src="/assets/images/logos/kong-logo-blue.svg" alt="Kong Logo" id="kong-logo">
    </a>
    <span class="logo-divider">|</span>
    <a href="/" class="navbar-brand col col-xl-auto">
      <img src="/assets/images/logos/docs-logo-steel.svg" alt="Kong Docs Logo" id="kong-docs-logo">
    </a>

    <div class="separator mobile"></div>
      <div class="search-input-wrapper" id="getkong-algolia-search-input">
    </div>

    <div class="search-results-wrapper"></div>

    <div class="separator"></div>
    <div class="navbar-items" role="navigation" aria-label="Main menu">
      <ul class="navbar-items" role="menubar">
        <li id="top-module-list" aria-haspopup="true" role="menuitem" aria-expanded="false" class="navbar-item main-menu-item with-submenu  active">
          <span tabindex="0" id="docs-link" class="main-menu-item-title">Docs</span>
          <span class="caret"></span>
          <ul class="navbar-item-submenu" role="menu">
            <div class="submenu-section">
              <li role="menuitem" class="docs-dropdown-li">
                <a href="/api/" class="docs-dropdown-li__link" tabindex="-1">
                  <div class="docs-dropdown-li__card">
                    <span class="heading">Explore the API Specs</span>
                    <div class="docs-dropdown-li__card-link">
                      <img src="/assets/images/landing-page/view-all-api-specs.png" alt="View all API Specs">
                      <span class="docs-dropdown-li__card-image">
                        View all API Specs
                        <img src="/assets/images/landing-page/arrow-right.svg" alt="View all API Specs arrow image">
                      </span>
                    </div>
                  </div>
                </a>
              </li>

              <li role="menuitem" class="docs-dropdown-li" tabindex="-1">
                <div class="docs-dropdown-li__section">
                  <div class="docs-dropdown-li__section-title">
                    <span class="heading">Documentation</span>
                  </div>

                  <div class="docs-dropdown-li__section-items">
                    <a class="item item-all" href="/api/" tabindex="-1">
                      <div class="item__description">
                        <div class="item__description-title">API Specs</div>
                      </div>
                    </a>
                    
                      <a class="item" href="/gateway/latest/" tabindex="-1">
                        
                        <div class="item__description">
                          <div class="item__description-title">Kong Gateway</div>
                          <div class="item__description-desc">Lightweight, fast, and flexible cloud-native API gateway</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/konnect/" tabindex="-1">
                        
                        <div class="item__description">
                          <div class="item__description-title">Kong Konnect</div>
                          <div class="item__description-desc">Single platform for SaaS end-to-end connectivity</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/mesh/latest/" tabindex="-1">
                        
                        <div class="item__description">
                          <div class="item__description-title">Kong Mesh</div>
                          <div class="item__description-desc">Enterprise service mesh based on Kuma and Envoy</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/deck/latest/" tabindex="-1">
                        
                        <div class="item__description">
                          <div class="item__description-title">decK</div>
                          <div class="item__description-desc">Helps manage Kongâ€™s configuration in a declarative fashion</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/kubernetes-ingress-controller/latest/" tabindex="-1">
                        
                        <div class="item__description">
                          <div class="item__description-title">Kong Ingress Controller</div>
                          <div class="item__description-desc">Works inside a Kubernetes cluster and configures Kong to proxy traffic</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/gateway-operator/latest/" tabindex="-1">
                        
                        <div class="item__description">
                          <div class="item__description-title">Kong Gateway Operator</div>
                          <div class="item__description-desc">Manage your Kong deployments on Kubernetes using YAML Manifests</div>
                        </div>
                      </a>
                    
                      <a class="item" href="https://docs.insomnia.rest/" tabindex="-1" target="_blank" rel="noopener nofollow noreferrer ">
                        
                        <div class="item__description">
                          <div class="item__description-title">Insomnia</div>
                          <div class="item__description-desc">Collaborative API development platform</div>
                        </div>
                      </a>
                    
                      <a class="item" href="https://kuma.io/docs/" tabindex="-1" target="_blank" rel="noopener nofollow noreferrer ">
                        
                        <div class="item__description">
                          <div class="item__description-title">Kuma</div>
                          <div class="item__description-desc">Open-source distributed control plane with a bundled Envoy Proxy integration</div>
                        </div>
                      </a>
                    
                  </div>
                </div>
              </li>

            </div>
          </ul>
        </li>

        <li role="menuitem" aria-haspopup="true" aria-expanded="false" class="navbar-item main-menu-item with-submenu navbar-item-hub">
          <span id="plugin-link" class="main-menu-item-title" tabindex="0">Plugin Hub</span>
          <span class="caret"></span>
          <ul class="navbar-item-submenu" role="menu">
            <div class="submenu-section">
              <li role="menuitem" class="docs-dropdown-li">
                <a href="/hub/" class="docs-dropdown-li__link" tabindex="-1">
                  <div class="docs-dropdown-li__card">
                    <span class="heading">Explore the Plugin Hub</span>
                    <div class="docs-dropdown-li__card-link">
                      <img src="/assets/images/landing-page/view-all-plugins.svg" alt="View all plugins">
                      <span class="docs-dropdown-li__card-image">
                        View all plugins
                        <img src="/assets/images/landing-page/arrow-right.svg" alt="View all plugins arrow image">
                      </span>
                    </div>
                  </div>
                </a>
              </li>

              <li role="menuitem" class="docs-dropdown-li">
                <div class="docs-dropdown-li__section">
                  <div class="docs-dropdown-li__section-title">
                    <span class="heading">Functionality</span>
                    <a href="/hub/" class="view-all" tabindex="-1">
                      View all
                      <img src="/assets/images/landing-page/arrow-right.svg" alt="View all arrow image">
                    </a>
                  </div>

                  <div class="docs-dropdown-li__section-items">
                    <a class="item item-all" href="/hub/" tabindex="-1">
                      <div class="item__description">
                        <div class="item__description-title">View all plugins</div>
                      </div>
                    </a>

                    
                      <a class="item" href="/hub/?category=authentication" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/lock_person.svg" alt="Authentication's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Authentication</div>
                          <div class="item__description-desc">Protect your services with an authentication layer</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/hub/?category=security" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/shield.svg" alt="Security's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Security</div>
                          <div class="item__description-desc">Protect your services with additional security layer</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/hub/?category=traffic-control" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/route.svg" alt="Traffic Control's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Traffic Control</div>
                          <div class="item__description-desc">Manage, throttle and restrict inbound and outbound API traffic</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/hub/?category=serverless" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/serverless.svg" alt="Serverless's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Serverless</div>
                          <div class="item__description-desc">Invoke serverless functions in combination with other plugins</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/hub/?category=analytics-monitoring" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/bar_chart.svg" alt="Analytics &amp; Monitoring's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Analytics &amp; Monitoring</div>
                          <div class="item__description-desc">Visualize, inspect and monitor APIs and microservices traffic</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/hub/?category=transformations" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/swap_horiz.svg" alt="Transformations's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Transformations</div>
                          <div class="item__description-desc">Transform request and responses on the fly on Kong</div>
                        </div>
                      </a>
                    
                      <a class="item" href="/hub/?category=logging" tabindex="-1">
                        <div>
                          <img src="/assets/images/nav/hub/list_alt.svg" alt="Logging's icon">
                        </div>
                        <div class="item__description">
                          <div class="item__description-title">Logging</div>
                          <div class="item__description-desc">Log request and response data using the best transport for your infrastructure</div>
                        </div>
                      </a>
                    

                  </div>
                </div>
              </li>
            </div>
          </ul>
        </li>
        <li role="menuitem" class="main-menu-item">
          <a href="https://support.konghq.com/" class="navbar-item" target="_blank" rel="noopener nofollow noreferrer ">Support</a>
        </li>
        <li role="menuitem" class="main-menu-item">
          <a href="https://konghq.com/community/" class="navbar-item" target="_blank" rel="noopener noreferrer">Community</a>
        </li>
        <li role="menuitem" class="main-menu-item">
          <a href="https://education.konghq.com" class="navbar-item" target="_blank" rel="noopener nofollow noreferrer ">Kong Academy</a>
        </li>
      </ul>
      <a id="top-cta" href="https://konghq.com/contact-sales?utm_source=docs.konghq.com" class="navbar-button" target="_blank" rel="noopener nofollow noreferrer ">
        Get a Demo
      </a>
      <a id="konnect-cta" href="https://konghq.com/products/kong-konnect/register?utm_medium=referral&amp;utm_source=docs&amp;utm_campaign=gateway-konnect&amp;utm_content=top-nav" class="navbar-button" target="_blank" rel="noopener nofollow noreferrer ">
        Start Free Trial
      </a>
    </div>
    <div id="navbar-menu-toggle-button" class="small-screen-button" aria-label="Toggle navigation">
      <div></div>
      <div></div>
      <div></div>
    </div>
  </div>
</header>


    

<div class="page v2 " data-url="/gateway/2.7.x/plugin-development/custom-entities/">
  <div class="page--header-background page--header-background-doc"></div>
  <div class="container">

    <header class="page-header page-header-doc">
      <div class="page-header-product-version">
        <div class="edition">
          Kong Gateway
          
        </div>
        
        <div class="version">
          2.7.x
          
        </div>
        
      </div>
      <div class="page-header--nav">
        <i class="sidebar-toggle"></i>

        
          









  <ul class="breadcrumbs">
    <li class="breadcrumb-item">
      <a href="/">
        <img src="/assets/images/icons/hub-layout/icn-breadcrumbs.svg" alt="Home icon">
      </a>
    </li>
    <li class="breadcrumb-item">
      <a href="/gateway/2.7.x/">Kong Gateway</a>
    </li>

    
    
      

      

      
      

      
      

      
        <li class="breadcrumb-item">
          
          <a href="/gateway/2.7.x/plugin-development/">Plugin Development</a>
          
        </li>
      
    
      

      

      
      

      
      

      
    

    
    
    <li class="breadcrumb-item">
      <a href="/gateway/2.7.x/plugin-development/custom-entities/">Plugin Development - Storing Custom Entities</a>
    </li>
  </ul>

        

        

        <div class="github-links">
  <div class="github-links--edit">
    
      <a href="https://github.com/Kong/docs.konghq.com/edit/main/app/gateway/2.7.x/plugin-development/custom-entities.md" target="_blank" rel="noopener nofollow noreferrer ">
        <img src="/assets/images/icons/third-party/logo-github-white.svg" alt="github-edit-page">Edit this page
      </a>
    
  </div>
  <div class="github-links--issues">
    <a href="https://github.com/Kong/docs.konghq.com/issues" target="_blank" rel="noopener nofollow noreferrer ">
      <img src="/assets/images/icons/documentation/icn-monitoring-white.svg" alt="report-issue">Report an issue</a>
  </div>
</div>


      </div>
    </header>

    

<aside class="docs-sidebar">
  <i class="fa fa-times close-sidebar"></i>

  <div class="sidebar-title-container">
    <div class="docsets-dropdown dropdown">
      <button class="dropdown-button" id="module-dropdown" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" tabindex="0">
        <span>
          Kong Gateway
          
        </span>
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu dropdown-menu-right with-submenu" id="module-list" role="menu" aria-labelledby="module-dropdown" aria-hidden="true">

        <li role="menuitem" tabindex="-1" class="active">
          <a href="/gateway/latest/" class="active">Kong Gateway</a>
        </li>
        <li role="menuitem" tabindex="-1">
          <a href="/konnect/">Kong Konnect</a>
        </li>
        <li role="menuitem" tabindex="-1">
          <a href="/mesh/latest/">Kong Mesh</a>
        </li>
        <li role="menuitem" tabindex="-1">
          <a href="/hub/">Plugin Hub</a>
        </li>
        <li role="menuitem" tabindex="-1">
          <a href="/deck/latest/">decK</a>
        </li>
        <li role="menuitem" tabindex="-1">
          <a href="/kubernetes-ingress-controller/latest/">Kong Ingress Controller</a>
        </li>
        <li role="menuitem" tabindex="-1">
          <a href="/gateway-operator/latest/">Kong Gateway Operator</a>
        </li>
        <li>
          <a href="https://docs.insomnia.rest/" target="_blank" rel="noopener nofollow noreferrer ">Insomnia</a>
        </li>
        <li role="menuitem" tabindex="-1">
          <a href="https://kuma.io/docs/" target="_blank" rel="noopener nofollow noreferrer ">Kuma</a>
        </li>
        <hr>
        <li role="menuitem" tabindex="-1">
          <a href="/contributing/">Docs contribution guidelines</a>
        </li>
      </ul>
    </div>

    
    <div class="versions-dropdown dropdown">
      <button class="dropdown-button" id="version-dropdown" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" tabindex="0">
        <span>
          Version 2.7.x
          
        </span>
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu dropdown-menu-right" id="version-list" role="menu" aria-labelledby="version-dropdown" aria-hidden="true">
          
          
          
          
          
        <li role="menuitem" tabindex="-1">
          <a href="/gateway/3.5.x/plugin-development/custom-entities/" data-version-id="3.5.x">
            3.5.x
             <em>(latest)</em>
            
          </a>
        </li>
        
          
          
          
          
        <li role="menuitem" tabindex="-1">
          <a href="/gateway/3.4.x/plugin-development/custom-entities/" data-version-id="3.4.x">
            3.4.x
            
          </a>
        </li>
        
          
          
          
          
        <li role="menuitem" tabindex="-1">
          <a href="/gateway/3.3.x/plugin-development/custom-entities/" data-version-id="3.3.x">
            3.3.x
            
          </a>
        </li>
        
          
          
          
          
        <li role="menuitem" tabindex="-1">
          <a href="/gateway/3.2.x/plugin-development/custom-entities/" data-version-id="3.2.x">
            3.2.x
            
          </a>
        </li>
        
          
          
          
          
        <li role="menuitem" tabindex="-1">
          <a href="/gateway/3.1.x/plugin-development/custom-entities/" data-version-id="3.1.x">
            3.1.x
            
          </a>
        </li>
        
          
          
          
          
        <li role="menuitem" tabindex="-1">
          <a href="/gateway/3.0.x/plugin-development/custom-entities/" data-version-id="3.0.x">
            3.0.x
            
          </a>
        </li>
        
          
          
          
          
        <li role="menuitem" tabindex="-1">
          <a href="/gateway/2.8.x/plugin-development/custom-entities/" data-version-id="2.8.x">
            2.8.x
            
          </a>
        </li>
        
          
          
          
          
        <li class="active" role="menuitem" tabindex="-1">
          <a href="/gateway/2.7.x/plugin-development/custom-entities/" class="active" data-version-id="2.7.x">
            2.7.x
            
          </a>
        </li>
        
          
          
          
          
        <li role="menuitem" tabindex="-1">
          <a href="/gateway/2.6.x/plugin-development/custom-entities/" data-version-id="2.6.x">
            2.6.x
            
          </a>
        </li>
        
        
        <li role="menuitem" tabindex="-1">
          <a href="https://legacy-gateway--kongdocs.netlify.app/" target="_blank" rel="noopener nofollow noreferrer ">
            Archive (pre-2.6)
          </a>
        </li>
        
      </ul>
    </div>
    
  </div>

  <ul class="sidebar-container" role="tree" aria-label="Documentation">
    
      <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-1-introduction-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/">
        
  <img src="/assets/images/icons/documentation/icn-flag.svg" alt="">


Introduction

      </a>
    
  </span>

  
    <ul class="items" id="id-1-introduction-subtree" role="group" aria-label="Introduction">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/latest/support-policy/">
        

Version Support Policy

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/compatibility/">
        

Compatibility

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/changelog/">
        

Changelog

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

    
      <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-2-install-and-run-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/install-and-run/">
        
  <img src="/assets/images/icons/documentation/icn-deployment-color.svg" alt="">


Install and Run

      </a>
    
  </span>

  
    <ul class="items" id="id-2-install-and-run-subtree" role="group" aria-label="Install and Run">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/install-and-run/kubernetes/">
        

Kubernetes

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/install-and-run/helm/">
        

Helm

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/install-and-run/openshift/">
        

OpenShift with Helm

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/install-and-run/docker/">
        

Docker

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/install-and-run/amazon-linux/">
        

Amazon Linux

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/install-and-run/centos/">
        

CentOS

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/install-and-run/debian/">
        

Debian

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/install-and-run/rhel/">
        

RHEL

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/install-and-run/ubuntu/">
        

Ubuntu

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/install-and-run/migrate-ce-to-ke/">
        

Migrating from OSS to EE

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/install-and-run/upgrade-enterprise/">
        

Upgrade Kong Gateway

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/install-and-run/upgrade-oss/">
        

Upgrade Kong Gateway OSS

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

    
      <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-3-get-started-subtree">
    
      
  <img src="/assets/images/icons/documentation/icn-quickstart-color.svg" alt="">


Get Started


        
          <button class="sidebar-tree-toggle" aria-label="toggle Get Started subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-3-get-started-subtree" role="group" aria-label="Get Started">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-3-1-quickstart-guide-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/quickstart/">
        

Quickstart Guide

      </a>
    
  </span>

  
    <ul class="items" id="id-3-1-quickstart-guide-subtree" role="group" aria-label="Quickstart Guide">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/quickstart/configuring-a-service/">
        

Configuring a Service

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/quickstart/configuring-a-grpc-service/">
        

Configuring a gRPC Service

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/quickstart/enabling-plugins/">
        

Enabling Plugins

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/quickstart/adding-consumers/">
        

Adding Consumers

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-3-2-comprehensive-guide-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/comprehensive/">
        

Comprehensive Guide

      </a>
    
  </span>

  
    <ul class="items" id="id-3-2-comprehensive-guide-subtree" role="group" aria-label="Comprehensive Guide">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/comprehensive/prepare/">
        

Prepare to Administer

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/comprehensive/expose-services/">
        

Expose your Services

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/comprehensive/protect-services/">
        

Protect your Services

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/comprehensive/improve-performance/">
        

Improve Performance

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/comprehensive/secure-services/">
        

Secure Services

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/comprehensive/load-balancing/">
        

Set Up Intelligent Load Balancing

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/comprehensive/manage-teams/">
        

Manage Administrative Teams

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/get-started/comprehensive/dev-portal/">
        

Publish, Locate, and Consume Services

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
    </ul>
  
</li>

    
      <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-4-plan-and-deploy-subtree">
    
      
  <img src="/assets/images/icons/documentation/icn-deployment-color.svg" alt="">


Plan and Deploy


        
          <button class="sidebar-tree-toggle" aria-label="toggle Plan and Deploy subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-4-plan-and-deploy-subtree" role="group" aria-label="Plan and Deploy">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/kong-user/">
        

Running Kong as a Non-Root User

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/sizing-guidelines/">
        

Resource Sizing Guidelines

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-4-3-hybrid-mode-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/hybrid-mode/">
        

Hybrid Mode

      </a>
    
  </span>

  
    <ul class="items" id="id-4-3-hybrid-mode-subtree" role="group" aria-label="Hybrid Mode">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/hybrid-mode/hybrid-mode-setup/">
        

Deploy Kong Gateway in Hybrid Mode

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/kubernetes-deployment-options/">
        

Kubernetes Deployment Options

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/systemd/">
        

Control Kong Gateway through systemd

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/performance-testing-framework/">
        

Performance Testing Framework

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/dns-considerations/">
        

DNS Considerations

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/default-ports/">
        

Default Ports

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-4-9-licenses-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/licenses/">
        

Licenses

      </a>
    
  </span>

  
    <ul class="items" id="id-4-9-licenses-subtree" role="group" aria-label="Licenses">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/licenses/access-license/">
        

Access Your License

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/licenses/deploy-license/">
        

Deploy Your License

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/licenses/report/">
        

Monitor License Usage

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-4-10-security-subtree">
    
      

Security


        
          <button class="sidebar-tree-toggle" aria-label="toggle Security subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-4-10-security-subtree" role="group" aria-label="Security">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/security/start-kong-securely/">
        

Start Kong Gateway Securely

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/security/db-encryption/">
        

Keyring and Data Encryption

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plan-and-deploy/security/kong-security-update-process/">
        

Kong Security Update Process

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
    </ul>
  
</li>

    
      <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-5-configure-subtree">
    
      
  <img src="/assets/images/icons/konnect/konnect-settings.svg" alt="">


Configure


        
          <button class="sidebar-tree-toggle" aria-label="toggle Configure subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-5-configure-subtree" role="group" aria-label="Configure">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-5-1-authentication-and-authorization-subtree">
    
      

Authentication and Authorization


        
          <button class="sidebar-tree-toggle" aria-label="toggle Authentication and Authorization subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-5-1-authentication-and-authorization-subtree" role="group" aria-label="Authentication and Authorization">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/">
        

Authentication Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-5-1-2-openid-connect-plugin-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/oidc-use-case/">
        

OpenID Connect Plugin

      </a>
    
  </span>

  
    <ul class="items" id="id-5-1-2-openid-connect-plugin-subtree" role="group" aria-label="OpenID Connect Plugin">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/oidc-curity/">
        

OpenID Connect with Curity

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/oidc-azuread/">
        

OpenID Connect with Azure AD

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/oidc-google/">
        

OpenID Connect with Google

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/oidc-okta/">
        

OpenID Connect with Okta

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/oidc-auth0/">
        

OpenID Connect with Auth0

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/oidc-cognito/">
        

OpenID Connect with Cognito

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/hub/kong-inc/openid-connect/">
        

OpenID Connect Plugin Reference

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/allowing-multiple-authentication-methods/">
        

Allowing Multiple Authentication Methods

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-5-1-4-auth-for-kong-manager-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/kong-manager/">
        

Auth for Kong Manager

      </a>
    
  </span>

  
    <ul class="items" id="id-5-1-4-auth-for-kong-manager-subtree" role="group" aria-label="Auth for Kong Manager">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/kong-manager/super-admin/">
        

Create a Super Admin

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/kong-manager/networking/">
        

Configure Networking

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/kong-manager/email/">
        

Configure Kong Manager to Send Email

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/kong-manager/reset-password/">
        

Reset Passwords and RBAC Tokens

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/kong-manager/workspaces/">
        

Configure Workspaces

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/kong-manager/basic/">
        

Basic Auth

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/kong-manager/ldap/">
        

LDAP

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/kong-manager/oidc-mapping/">
        

OIDC

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/kong-manager/sessions/">
        

Sessions

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-5-1-5-role-based-access-control-rbac-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/rbac/">
        

Role-based Access Control (RBAC)

      </a>
    
  </span>

  
    <ul class="items" id="id-5-1-5-role-based-access-control-rbac-subtree" role="group" aria-label="Role-based Access Control (RBAC)">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/rbac/add-role/">
        

Add a Role

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/rbac/add-user/">
        

Add a User

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/rbac/add-admin/">
        

Add an Admin

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/auth/service-directory-mapping/">
        

Mapping LDAP Service Directory Groups to Kong Roles

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-5-2-kong-dev-portal-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/">
        

Kong Dev Portal

      </a>
    
  </span>

  
    <ul class="items" id="id-5-2-kong-dev-portal-subtree" role="group" aria-label="Kong Dev Portal">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/enable-dev-portal/">
        

Enable the Dev Portal

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/structure-and-file-types/">
        

Structure and File Types

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/dev-portal/api/v1/">
        

Portal API Documentation

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/working-with-templates/">
        

Working with Templates

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/using-the-editor/">
        

Using the Editor

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-5-2-6-configuration-subtree">
    
      

Configuration


        
          <button class="sidebar-tree-toggle" aria-label="toggle Configuration subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-5-2-6-configuration-subtree" role="group" aria-label="Configuration">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-5-2-6-1-authentication-subtree">
    
      

Authentication


        
          <button class="sidebar-tree-toggle" aria-label="toggle Authentication subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-5-2-6-1-authentication-subtree" role="group" aria-label="Authentication">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/configuration/authentication/basic-auth/">
        

Basic Auth

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/configuration/authentication/key-auth/">
        

Key Auth

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/configuration/authentication/oidc/">
        

OIDC

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/configuration/authentication/sessions/">
        

Sessions

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/configuration/authentication/adding-registration-fields/">
        

Adding Custom Registration Fields

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/configuration/smtp/">
        

SMTP

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/configuration/workspaces/">
        

Workspaces

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-5-2-7-administration-subtree">
    
      

Administration


        
          <button class="sidebar-tree-toggle" aria-label="toggle Administration subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-5-2-7-administration-subtree" role="group" aria-label="Administration">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/administration/managing-developers/">
        

Manage Developers

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/administration/developer-permissions/">
        

Developer Roles and Content Permissions

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-5-2-7-3-application-registration-subtree">
    
      

Application Registration


        
          <button class="sidebar-tree-toggle" aria-label="toggle Application Registration subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-5-2-7-3-application-registration-subtree" role="group" aria-label="Application Registration">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/administration/application-registration/auth-provider-strategy/">
        

Authorization Provider Strategy

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/administration/application-registration/enable-application-registration/">
        

Enable Application Registration

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/administration/application-registration/enable-key-auth-plugin/">
        

Enable Key Authentication for Application Registration

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/administration/application-registration/3rd-party-oauth/">
        

External OAuth2 Support

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/administration/application-registration/okta-config/">
        

Set up Okta and Kong for external OAuth

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/administration/application-registration/azure-oidc-config/">
        

Set Up Azure AD and Kong for External Authentication

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/administration/application-registration/managing-applications/">
        

Manage Applications

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-5-2-8-customization-subtree">
    
      

Customization


        
          <button class="sidebar-tree-toggle" aria-label="toggle Customization subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-5-2-8-customization-subtree" role="group" aria-label="Customization">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/theme-customization/easy-theme-editing/">
        

Easy Theme Editing

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/theme-customization/migrating-templates/">
        

Migrating Templates Between Workspaces

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/theme-customization/markdown-extended/">
        

Markdown Rendering Module

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/theme-customization/emails/">
        

Customizing Portal Emails

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/theme-customization/adding-javascript-assets/">
        

Adding and Using JavaScript Assets

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/theme-customization/single-page-app/">
        

Single Page App in Dev Portal

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/theme-customization/alternate-openapi-renderer/">
        

Alternate OpenAPI Renderer

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/developer-portal/helpers/cli/">
        

Helpers CLI

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/grpc/">
        

Configure gRPC Plugins

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/graphql-quickstart/">
        

GraphQL Quickstart

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/logging/">
        

Logging Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/configure/network/">
        

Network and Firewall

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

    
      <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-6-monitor-subtree">
    
      
  <img src="/assets/images/icons/documentation/icn-vitals.svg" alt="">


Monitor


        
          <button class="sidebar-tree-toggle" aria-label="toggle Monitor subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-6-monitor-subtree" role="group" aria-label="Monitor">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-6-1-kong-vitals-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/vitals/">
        

Kong Vitals

      </a>
    
  </span>

  
    <ul class="items" id="id-6-1-kong-vitals-subtree" role="group" aria-label="Kong Vitals">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/vitals/vitals-metrics/">
        

Metrics

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/vitals/vitals-reports/">
        

Reports

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/vitals/vitals-influx-strategy/">
        

Vitals with InfluxDB

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/vitals/vitals-prometheus-strategy/">
        

Vitals with Prometheus

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/vitals/vitals-estimates/">
        

Estimate Vitals Storage in PostgreSQL

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/hub/kong-inc/prometheus/">
        

Prometheus plugin

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/hub/kong-inc/zipkin/">
        

Zipkin plugin

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

    
      <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-7-reference-subtree">
    
      
  <img src="/assets/images/icons/documentation/icn-references-color.svg" alt="">


Reference


        
          <button class="sidebar-tree-toggle" aria-label="toggle Reference subtree">
            <i class="fa fa-chevron-down"></i>
          </button>
        
      
  </span>

  
    <ul class="items" id="id-7-reference-subtree" role="group" aria-label="Reference">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-7-1-admin-api-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/">
        

Admin API

      </a>
    
  </span>

  
    <ul class="items" id="id-7-1-admin-api-subtree" role="group" aria-label="Admin API">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#db-less-mode">
        

DB-less Mode

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#declarative-configuration">
        

Declarative Configuration

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#supported-content-types">
        

Supported Content Types

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#information-routes">
        

Information Routes

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#health-routes">
        

Health Routes

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#tags">
        

Tags

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#service-object">
        

Service Object

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#route-object">
        

Route Object

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#consumer-object">
        

Consumer Object

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#plugin-object">
        

Plugin Object

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#certificate-object">
        

Certificate Object

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#ca-certificate-object">
        

CA Certificate Object

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#sni-object">
        

SNI Object

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#upstream-object">
        

Upstream Object

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/#target-object">
        

Target Object

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-7-1-16-licenses-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/licenses/reference/">
        

Licenses

      </a>
    
  </span>

  
    <ul class="items" id="id-7-1-16-licenses-subtree" role="group" aria-label="Licenses">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/licenses/reference/">
        

Licenses Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/licenses/examples/">
        

Licenses Examples

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-7-1-17-workspaces-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/workspaces/reference/">
        

Workspaces

      </a>
    
  </span>

  
    <ul class="items" id="id-7-1-17-workspaces-subtree" role="group" aria-label="Workspaces">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/workspaces/reference/">
        

Workspaces Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/workspaces/examples/">
        

Workspace Examples

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-7-1-18-rbac-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/rbac/reference/">
        

RBAC

      </a>
    
  </span>

  
    <ul class="items" id="id-7-1-18-rbac-subtree" role="group" aria-label="RBAC">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/rbac/reference/">
        

RBAC Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/rbac/examples/">
        

RBAC Examples

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-7-1-19-admins-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/admins/reference/">
        

Admins

      </a>
    
  </span>

  
    <ul class="items" id="id-7-1-19-admins-subtree" role="group" aria-label="Admins">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/admins/reference/">
        

API Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/admins/examples/">
        

Examples

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-7-1-20-consumer-groups-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/consumer-groups/reference/">
        

Consumer Groups

      </a>
    
  </span>

  
    <ul class="items" id="id-7-1-20-consumer-groups-subtree" role="group" aria-label="Consumer Groups">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/consumer-groups/reference/">
        

API Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/consumer-groups/examples/">
        

Examples

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-7-1-21-event-hooks-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/event-hooks/reference/">
        

Event Hooks

      </a>
    
  </span>

  
    <ul class="items" id="id-7-1-21-event-hooks-subtree" role="group" aria-label="Event Hooks">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/event-hooks/reference/">
        

Event Hooks Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/event-hooks/examples/">
        

Examples

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/audit-log/">
        

Audit Logging

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/db-encryption/">
        

Keyring and Data Encryption

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/admin-api/secure-admin-api/">
        

Securing the Admin API

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/reference/db-less-and-declarative-config/">
        

DB-less and Declarative Configuration

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/reference/configuration/">
        

Configuration Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/reference/cli/">
        

CLI Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/reference/loadbalancing/">
        

Load Balancing Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/reference/proxy/">
        

Proxy Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/reference/rate-limiting/">
        

Rate Limiting Library

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/reference/health-checks-circuit-breakers/">
        

Health Checks and Circuit Breakers Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/reference/clustering/">
        

Clustering Reference

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-7-10-plugin-development-kit-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/">
        

Plugin Development Kit

      </a>
    
  </span>

  
    <ul class="items" id="id-7-10-plugin-development-kit-subtree" role="group" aria-label="Plugin Development Kit">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.client/">
        

kong.client

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.client.tls/">
        

kong.client.tls

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.cluster/">
        

kong.cluster

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.ctx/">
        

kong.ctx

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.ip/">
        

kong.ip

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.log/">
        

kong.log

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.nginx/">
        

kong.nginx

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.node/">
        

kong.node

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.request/">
        

kong.request

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.response/">
        

kong.response

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.router/">
        

kong.router

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.service/">
        

kong.service

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.service.request/">
        

kong.service.request

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.service.response/">
        

kong.service.response

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/pdk/kong.table/">
        

kong.table

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label" aria-expanded="false" aria-owns="id-7-11-plugin-development-guide-subtree">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plugin-development/">
        

Plugin Development Guide

      </a>
    
  </span>

  
    <ul class="items" id="id-7-11-plugin-development-guide-subtree" role="group" aria-label="Plugin Development Guide">
      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plugin-development/">
        

Introduction

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plugin-development/file-structure/">
        

File structure

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plugin-development/custom-logic/">
        

Implementing custom logic

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plugin-development/plugin-configuration/">
        

Plugin configuration

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plugin-development/access-the-datastore/">
        

Accessing the datastore

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plugin-development/custom-entities/">
        

Storing custom entities

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plugin-development/entities-cache/">
        

Caching custom entities

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plugin-development/admin-api/">
        

Extending the Admin API

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plugin-development/tests/">
        

Writing tests

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/plugin-development/distribution/">
        

(un)Installing your plugin

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/2.7.x/reference/external-plugins/">
        

Plugins in Other Languages

      </a>
    
  </span>

  
</li>

      
        
        <li class="sidebar-item" role="none">
  <span role="treeitem" class="sidebar-label">
    
      <a class="sidebar-link" tabindex="-1" href="/gateway/3.0.x/reference/file-access-permissions/">
        

File Permissions Reference

      </a>
    
  </span>

  
</li>

      
    </ul>
  
</li>

    
  </ul>
</aside>




      <aside class="docs-toc">
        <i class="fa fa-times close-sidebar"></i>
        <i class="fa fa-chevron-right collapse-toc"></i>
        <i class="far fa-list-alt expand-toc"></i>

        <div id="oss-ee-toggle" data-current="Enterprise" style="display: none">
          <span class="oss-ee-toggle-inner">
            <img src="/assets/images/icons/icn-enterprise-black.svg" alt="enterprise-switcher-icon">
            <span>Switch to <span id="switch-to-version">OSS</span></span>
          </span>
        </div>

        
        <div class="docs-toc-title">
<img src="/assets/images/icons/hub-layout/icn-on-this-page.svg" alt="On this page"><a href="#">On this page</a>
</div>
<ul>
  <li><a href="#modules" class="active scroll-to">Modules</a></li>
  <li><a href="#create-the-migrations-folder" class="scroll-to">Create the migrations folder</a></li>
  <li><a href="#add-a-new-migration-to-an-existing-plugin" class="scroll-to">Add a new migration to an existing plugin</a></li>
  <li><a href="#migration-file-syntax" class="scroll-to">Migration file syntax</a></li>
  <li><a href="#define-a-schema" class="scroll-to">Define a schema</a></li>
  <li>
<a href="#the-custom-dao" class="scroll-to">The custom DAO</a>
    <ul>
      <li><a href="#select-an-entity" class="scroll-to">Select an entity</a></li>
      <li><a href="#iterate-over-all-the-entities" class="scroll-to">Iterate over all the entities</a></li>
      <li><a href="#insert-an-entity" class="scroll-to">Insert an entity</a></li>
      <li><a href="#update-an-entity" class="scroll-to">Update an entity</a></li>
      <li><a href="#upsert-an-entity" class="scroll-to">Upsert an entity</a></li>
      <li><a href="#delete-an-entity" class="scroll-to">Delete an entity</a></li>
    </ul>
  </li>
  <li><a href="#cache-custom-entities" class="scroll-to">Cache custom entities</a></li>
</ul>

        
      </aside>

    <div class="page-content-container page-content-container-doc v2 " id="documentation">
      <div class="toggles ">
          <i class="far fa-list-alt toc-sidebar-toggle"></i>
      </div>

      <div class="page-content">
        <div class="content show-anchor-links">
          
              <blockquote id="version-notice" class="important">
                
                You are browsing documentation for an outdated version.
                
                See the <a href="/gateway/latest/plugin-development/custom-entities/">latest documentation here</a>.
              </blockquote>
          

          <h1 tabindex="-1" id="main" class="page-content-title">Plugin Development - Storing Custom Entities
            

            
          </h1>

          

          
          

          <p>While not all plugins need it, your plugin might need to store more than
its configuration in the database. In that case, Kong provides you with
an abstraction on top of its primary datastores which allows you to store
custom entities.</p>

<p>As explained in the <a href="/gateway/2.7.x/plugin-development/access-the-datastore/">previous chapter</a>, Kong interacts
with the model layer through classes we refer to as â€œDAOsâ€, and available on a
singleton often referred to as the â€œDAO Factoryâ€. This chapter will explain how
to provide an abstraction for your own entities.</p>

<h2 id="modules">Modules</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kong.plugins.&lt;plugin_name&gt;.daos
kong.plugins.&lt;plugin_name&gt;.migrations.init
kong.plugins.&lt;plugin_name&gt;.migrations.000_base_&lt;plugin_name&gt;
kong.plugins.&lt;plugin_name&gt;.migrations.001_&lt;from-version&gt;_to_&lt;to_version&gt;
kong.plugins.&lt;plugin_name&gt;.migrations.002_&lt;from-version&gt;_to_&lt;to_version&gt;
</code></pre></div></div>

<h2 id="create-the-migrations-folder">Create the migrations folder</h2>

<p>Once you have defined your model, you must create your migration modules which
will be executed by Kong to create the table in which your records of your
entity will be stored.</p>

<blockquote class="warning no-icon">
  <p><strong>Deprecation warning:</strong> Cassandra as a backend database for Kong Gateway
is deprecated. Support for Cassandra will be removed in a future release.
<br>
Our target for Cassandra removal is the Kong Gateway 3.4 release.
Starting with the Kong Gateway 3.0 release, some new features might
not be supported with Cassandra.</p>
</blockquote>

<p>If your plugin is intended to support both Cassandra and PostgreSQL, then both
migrations must be written.</p>

<p>If your plugin doesnâ€™t have it already, you should add a <code class="language-plaintext highlighter-rouge">&lt;plugin_name&gt;/migrations</code>
folder to it. If there is no <code class="language-plaintext highlighter-rouge">init.lua</code> file inside already, you should create one.
This is where all the migrations for your plugin will be referenced.</p>

<p>The initial version of your <code class="language-plaintext highlighter-rouge">migrations/init.lua</code> file will point to a single migration.</p>

<p>In this case we have called it <code class="language-plaintext highlighter-rouge">000_base_my_plugin</code>.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- `migrations/init.lua`</span>
<span class="k">return</span> <span class="p">{</span>
  <span class="s2">"000_base_my_plugin"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This means that there will be a file in <code class="language-plaintext highlighter-rouge">&lt;plugin_name&gt;/migrations/000_base_my_plugin.lua</code>
containing the initial migrations. Weâ€™ll see how this is done in a minute.</p>

<h2 id="add-a-new-migration-to-an-existing-plugin">Add a new migration to an existing plugin</h2>

<p>Sometimes it is necessary to introduce changes after a version of a plugin has already been
released. A new functionality might be needed. A database table row might need changing.</p>

<p>When this happens, <em>you must</em> create a new migrations file. You <em>must not</em> of modify the
existing migration files once they are published (you can still make them more robust and
bulletproof if you want, e.g. always try to write the migrations reentrant).</p>

<p>While there is no strict rule for naming your migration files, there is a convention that the
initial one is prefixed by <code class="language-plaintext highlighter-rouge">000</code>, the next one by <code class="language-plaintext highlighter-rouge">001</code>, and so on.</p>

<p>Following with our previous example, if we wanted to release a new version of the plugin with
changes in the database (for example, a table was needed called <code class="language-plaintext highlighter-rouge">foo</code>) we would insert it by
adding a file called <code class="language-plaintext highlighter-rouge">&lt;plugin_name&gt;/migrations/001_100_to_110.lua</code>, and referencing it on the
migrations init file like so (where <code class="language-plaintext highlighter-rouge">100</code> is the previous version of the plugin <code class="language-plaintext highlighter-rouge">1.0.0</code> and
<code class="language-plaintext highlighter-rouge">110</code> is the version to which plugin is migrated to <code class="language-plaintext highlighter-rouge">1.1.0</code>:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- `&lt;plugin_name&gt;/migrations/init.lua`</span>
<span class="k">return</span> <span class="p">{</span>
  <span class="s2">"000_base_my_plugin"</span><span class="p">,</span>
  <span class="s2">"001_100_to_110"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="migration-file-syntax">Migration file syntax</h2>

<blockquote class="warning no-icon">
  <p><strong>Deprecation warning:</strong> Cassandra as a backend database for Kong Gateway
is deprecated. Support for Cassandra will be removed in a future release.
<br>
Our target for Cassandra removal is the Kong Gateway 3.4 release.
Starting with the Kong Gateway 3.0 release, some new features might
not be supported with Cassandra.</p>
</blockquote>

<p>While Kongâ€™s core migrations support both PostgreSQL and Cassandra, custom plugins
can choose to support either both of them or just one.</p>

<p>A migration file is a Lua file which returns a table with the following structure:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- `&lt;plugin_name&gt;/migrations/000_base_my_plugin.lua`</span>
<span class="k">return</span> <span class="p">{</span>
  <span class="n">postgresql</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">up</span> <span class="o">=</span> <span class="s">[[
      CREATE TABLE IF NOT EXISTS "my_plugin_table" (
        "id"           UUID                         PRIMARY KEY,
        "created_at"   TIMESTAMP WITHOUT TIME ZONE,
        "col1"         TEXT
      );

      DO $$
      BEGIN
        CREATE INDEX IF NOT EXISTS "my_plugin_table_col1"
                                ON "my_plugin_table" ("col1");
      EXCEPTION WHEN UNDEFINED_COLUMN THEN
        -- Do nothing, accept existing state
      END$$;
    ]]</span><span class="p">,</span>
  <span class="p">},</span>

  <span class="n">cassandra</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">up</span> <span class="o">=</span> <span class="s">[[
      CREATE TABLE IF NOT EXISTS my_plugin_table (
        id          uuid PRIMARY KEY,
        created_at  timestamp,
        col1        text
      );

      CREATE INDEX IF NOT EXISTS ON my_plugin_table (col1);
    ]]</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">-- `&lt;plugin_name&gt;/migrations/001_100_to_110.lua`</span>
<span class="k">return</span> <span class="p">{</span>
  <span class="n">postgresql</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">up</span> <span class="o">=</span> <span class="s">[[
      DO $$
      BEGIN
        ALTER TABLE IF EXISTS ONLY "my_plugin_table" ADD "cache_key" TEXT UNIQUE;
      EXCEPTION WHEN DUPLICATE_COLUMN THEN
        -- Do nothing, accept existing state
      END;
    $$;
    ]]</span><span class="p">,</span>
    <span class="n">teardown</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">connector</span><span class="p">,</span> <span class="n">helpers</span><span class="p">)</span>
      <span class="nb">assert</span><span class="p">(</span><span class="n">connector</span><span class="p">:</span><span class="n">connect_migrations</span><span class="p">())</span>
      <span class="nb">assert</span><span class="p">(</span><span class="n">connector</span><span class="p">:</span><span class="n">query</span><span class="p">(</span><span class="s">[[
        DO $$
        BEGIN
          ALTER TABLE IF EXISTS ONLY "my_plugin_table" DROP "col1";
        EXCEPTION WHEN UNDEFINED_COLUMN THEN
          -- Do nothing, accept existing state
        END$$;
      ]]</span><span class="p">)</span>
    <span class="k">end</span><span class="p">,</span>
  <span class="p">},</span>

  <span class="n">cassandra</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">up</span> <span class="o">=</span> <span class="s">[[
      ALTER TABLE my_plugin_table ADD cache_key text;
      CREATE INDEX IF NOT EXISTS ON my_plugin_table (cache_key);
    ]]</span><span class="p">,</span>
    <span class="n">teardown</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">connector</span><span class="p">,</span> <span class="n">helpers</span><span class="p">)</span>
      <span class="nb">assert</span><span class="p">(</span><span class="n">connector</span><span class="p">:</span><span class="n">connect_migrations</span><span class="p">())</span>
      <span class="nb">assert</span><span class="p">(</span><span class="n">connector</span><span class="p">:</span><span class="n">query</span><span class="p">(</span><span class="s2">"ALTER TABLE my_plugin_table DROP col1"</span><span class="p">))</span>
    <span class="k">end</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If a plugin only supports PostgreSQL or Cassandra, only the section for one strategy is
needed. Each strategy section has two parts, <code class="language-plaintext highlighter-rouge">up</code> and <code class="language-plaintext highlighter-rouge">teardown</code>.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">up</code> is an optional string of raw SQL/CQL statements. Those statements will be executed
when <code class="language-plaintext highlighter-rouge">kong migrations up</code> is executed.</li>
  <li>
<code class="language-plaintext highlighter-rouge">teardown</code> is an optional Lua function, which takes a <code class="language-plaintext highlighter-rouge">connector</code> parameter. Such connector
can invoke the <code class="language-plaintext highlighter-rouge">query</code> method to execute SQL/CQL queries. Teardown is triggered by
<code class="language-plaintext highlighter-rouge">kong migrations finish</code>
</li>
</ul>

<p>It is recommended that all the non-destructive operations, such as creation of new tables and
addition of new records is done on the <code class="language-plaintext highlighter-rouge">up</code> sections, while destructive operations (such as
removal of data, changing row types, insertion of new data) is done on the <code class="language-plaintext highlighter-rouge">teardown</code> sections.</p>

<p>In both cases, it is recommended that all the SQL/CQL statements are written so that they are
as reentrant as possible. <code class="language-plaintext highlighter-rouge">DROP TABLE IF EXISTS</code> instead of <code class="language-plaintext highlighter-rouge">DROP TABLE</code>,
<code class="language-plaintext highlighter-rouge">CREATE INDEX IF NOT EXIST</code> instead of <code class="language-plaintext highlighter-rouge">CREATE INDEX</code>, etc. If a migration fails for some
reason, it is expected that the first attempt at fixing the problem will be simply
re-running the migrations.</p>

<p>While PostgreSQL does, Cassandra does not support constraints such as â€œNOT
NULLâ€, â€œUNIQUEâ€ or â€œFOREIGN KEYâ€, but Kong provides you with such features when
you define your modelâ€™s schema. Bear in mind that this schema will be the same
for both PostgreSQL and Cassandra, hence, you might trade-off a pure SQL schema
for one that works with Cassandra too.</p>

<p><strong>IMPORTANT</strong>: if your <code class="language-plaintext highlighter-rouge">schema</code> uses a <code class="language-plaintext highlighter-rouge">unique</code> constraint, then Kong will
enforce it for Cassandra, but for PostgreSQL you must set this constraint in
the migrations.</p>

<p>To see a real-life example, give a look at the <a href="https://github.com/Kong/kong/tree/master/kong/plugins/key-auth/migrations" target="_blank" rel="noopener nofollow noreferrer ">Key-Auth plugin migrations</a>.</p>

<h2 id="define-a-schema">Define a schema</h2>

<p>The first step to using custom entities in a custom plugin is defining one
or more <em>schemas</em>.</p>

<p>A schema is a Lua table which describes entities. Thereâ€™s structural information
like how are the different fields of the entity named and what are their types,
which is similar to the fields describing your <a href="/gateway/2.7.x/plugin-development/plugin-configuration/">plugin
configuration</a>).
Compared to plugin configuration schemas, custom entity schemas require
additional metadata (e.g. which field, or fields, constitute the entitiesâ€™
primary key).</p>

<p>Schemas are to be defined in a module named:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kong.plugins.&lt;plugin_name&gt;.daos
</code></pre></div></div>

<p>Meaning that there should be a file called <code class="language-plaintext highlighter-rouge">&lt;plugin_name&gt;/daos.lua</code> inside your
plugin folder. The <code class="language-plaintext highlighter-rouge">daos.lua</code> file should return a table containing one or more
schemas. For example:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- daos.lua</span>
<span class="kd">local</span> <span class="n">typedefs</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">"kong.db.schema.typedefs"</span>


<span class="k">return</span> <span class="p">{</span>
  <span class="c1">-- this plugin only results in one custom DAO, named `keyauth_credentials`:</span>
  <span class="p">{</span>
    <span class="n">name</span>                  <span class="o">=</span> <span class="s2">"keyauth_credentials"</span><span class="p">,</span> <span class="c1">-- the actual table in the database</span>
    <span class="n">endpoint_key</span>          <span class="o">=</span> <span class="s2">"key"</span><span class="p">,</span>
    <span class="n">primary_key</span>           <span class="o">=</span> <span class="p">{</span> <span class="s2">"id"</span> <span class="p">},</span>
    <span class="n">cache_key</span>             <span class="o">=</span> <span class="p">{</span> <span class="s2">"key"</span> <span class="p">},</span>
    <span class="n">generate_admin_api</span>    <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
    <span class="n">admin_api_name</span>        <span class="o">=</span> <span class="s2">"key-auths"</span><span class="p">,</span>
    <span class="n">admin_api_nested_name</span> <span class="o">=</span> <span class="s2">"key-auth"</span><span class="p">,</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">{</span>
        <span class="c1">-- a value to be inserted by the DAO itself</span>
        <span class="c1">-- (think of serial id and the uniqueness of such required here)</span>
        <span class="n">id</span> <span class="o">=</span> <span class="n">typedefs</span><span class="p">.</span><span class="n">uuid</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="c1">-- also interted by the DAO itself</span>
        <span class="n">created_at</span> <span class="o">=</span> <span class="n">typedefs</span><span class="p">.</span><span class="n">auto_timestamp_s</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="c1">-- a foreign key to a consumer's id</span>
        <span class="n">consumer</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nb">type</span>      <span class="o">=</span> <span class="s2">"foreign"</span><span class="p">,</span>
          <span class="n">reference</span> <span class="o">=</span> <span class="s2">"consumers"</span><span class="p">,</span>
          <span class="n">default</span>   <span class="o">=</span> <span class="n">ngx</span><span class="p">.</span><span class="n">null</span><span class="p">,</span>
          <span class="n">on_delete</span> <span class="o">=</span> <span class="s2">"cascade"</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="c1">-- a unique API key</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nb">type</span>      <span class="o">=</span> <span class="s2">"string"</span><span class="p">,</span>
          <span class="n">required</span>  <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
          <span class="n">unique</span>    <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
          <span class="n">auto</span>      <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This example <code class="language-plaintext highlighter-rouge">daos.lua</code> file introduces a single schema called <code class="language-plaintext highlighter-rouge">keyauth_credentials</code>.</p>

<p>Here is a description of some top-level properties:</p>

<table>
<tbody>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
  <td><code>name</code></td>
  <td>
<code>string</code> (required)</td>
  <td>It will be used to determine the DAO name (<code>kong.db.[name]</code>).</td>
</tr>
<tr>
  <td><code>primary_key</code></td>
  <td>
<code>table</code> (required)</td>
  <td>
    Field names forming the entity's primary key.
    Schemas support composite keys, even if most Kong core entities currently use an UUID named
    <code>id</code>. If you are using Cassandra and need a composite key, it should have the same
    fields as the partition key.
  </td>
</tr>
<tr>
<td><code>endpoint_key</code></td>
  <td>
<code>string</code> (optional)</td>
  <td>
    The name of the field used as an alternative identifier on the Admin API.
    On the example above, <code>key</code> is the endpoint_key. This means that a credential with
    <code>id = 123</code> and <code>key = "foo"</code> could be referenced as both
    <code>/keyauth_credentials/123</code> and <code>/keyauth_credentials/foo</code>.
  </td>
</tr>
<tr>
  <td><code>cache_key</code></td>
  <td>
<code>table</code> (optional)</td>
  <td>
    Contains the name of the fields used for generating the <code>cache_key</code>, a string which must
    unequivocally identify the entity inside Kong's cache. A unique field, like <code>key</code> in your example,
    is usually good candidate. In other cases a combination of several fields is preferable.
  </td>
</tr>
<tr>
  <td><code>generate_admin_api</code></td>
  <td>
<code>boolean</code> (optional)</td>
  <td>
    Whether to auto-generate admin api for the entity or not. By default the admin api is generated for all
   daos, including custom ones. If you want to create a fully customized admin api for the dao or
    want to disable auto-generation for the dao altogether, set this option to <code>false</code>.
  </td>
</tr>
<tr>
  <td><code>admin_api_name</code></td>
  <td>
<code>boolean</code> (optional)</td>
  <td>
    When <code>generate_admin_api</code> is enabled the admin api auto-generator uses the <code>name</code>
    to derive the collection urls for the auto-generated admin api. Sometimes you may want to name the
    collection urls differently from the <code>name</code>. E.g. with DAO <code>keyauth_credentials</code>
    we actually wanted the auto-generator to generate endpoints for this dao with alternate and more
    url-friendly name <code>key-auths</code>, e.g. <code>http://&lt;KONG_ADMIN&gt;/key-auths</code> instead of
    <code>http://&lt;KONG_ADMIN&gt;/keyauth_credentials</code>).
  </td>
</tr>
<tr>
  <td><code>admin_api_nested_name</code></td>
  <td>
<code>boolean</code> (optional)</td>
  <td>
    Similar to <code>admin_api_name</code> the <code>admin_api_nested_name</code> specifies the name for
    a dao that admin api auto-generator creates in nested contexts. You only need to use this parameter
    if you are not happy with <code>name</code> or <code>admin_api_name</code>. Kong for legacy reasons
    have urls like <code>http://&lt;KONG_ADMIN&gt;/consumers/john/key-auth</code> where <code>key-auth</code>
    does not follow plural form of <code>http://&lt;KONG_ADMIN&gt;/key-auths</code>. <code>admin_api_nested_name</code>
    enables you to specify different name in those cases.
  </td>
</tr>
<tr>
  <td><code>fields</code></td>
  <td><code>table</code></td>
  <td>
    Each field definition is a table with a single key, which is the field's name. The table value is
    a subtable containing the field's <em>attributes</em>, some of which will be explained below.
  </td>
</tr>
</tbody>
</table>

<p>Many field attributes encode <em>validation rules</em>. When attempting to insert or update entities using
the DAO, these validations will be checked, and an error returned if the provided input doesnâ€™t conform
to them.</p>

<p>The <code class="language-plaintext highlighter-rouge">typedefs</code> variable (obtained by requiring <code class="language-plaintext highlighter-rouge">kong.db.schema.typedefs</code>) is a table containing
a lot of useful type definitions and aliases, including <code class="language-plaintext highlighter-rouge">typedefs.uuid</code>, the most usual type for the primary key,
and <code class="language-plaintext highlighter-rouge">typedefs.auto_timestamp_s</code>, for <code class="language-plaintext highlighter-rouge">created_at</code> fields. It is used extensively when defining fields.</p>

<p>Hereâ€™s a non-exhaustive explanation of some of the field attributes available:</p>

<table>
<tbody>
<tr>
<th>Attribute name</th>
<th>type</th>
<th>Description</th>
</tr>
<tr>
  <td><code>type</code></td>
  <td><code>string</code></td>
  <td>
    Schemas support the following scalar types: <code>"string"</code>, <code>"integer"</code>, <code>"number"</code> and
    <code>"boolean"</code>. Compound types like <code>"array"</code>, <code>"record"</code>, or <code>"set"</code> are
    also supported.<br><br>

    In additon to these values, the <code>type</code> attribute can also take the special <code>"foreign"</code> value,
    which denotes a foreign relationship.<br><br>

    Each field will need to be backed by database fields of appropriately similar types, created via migrations.<br><br>

    <code>type</code> is the only required attribute for all field definitions.
  </td>
</tr>
<tr>
  <td><code>default</code></td>
  <td>
<code>any</code> (matching with <code>type</code> attribute)</td>
  <td>
    Specifies the value the field will have when attempting to insert it, if no value was provided.
    Default values are always set via Lua, never by the underlying database. It is thus not recommended to set
    any default values on fields in migrations.
  </td>
</tr>
<tr>
  <td><code>required</code></td>
  <td><code>boolean</code></td>
  <td>
    When set to <code>true</code> on a field, an error will be thrown when attempting to insert an entity lacking a value
    for said field (unless the field in question has a default value).
  </td>
</tr>
<tr>
  <td><code>unique</code></td>
  <td><code>boolean</code></td>
  <td>
  <p>When set to <code>true</code> on a field, an error will be thrown when attempting to insert an entity on the database,
    but another entity already has the given value on said field.</p>

  <p>This attribute <em>must</em> be backed up by declaring fields as <code>UNIQUE</code> in migrations when using
    PostgreSQL. The Cassandra strategy does a check in Lua before attempting inserts, so it doesn't require any special treatment.
  </p>
  </td>
</tr>
<tr>
  <td><code>auto</code></td>
  <td><code>boolean</code></td>
  <td>
  When attempting to insert an entity without providing a value for this a field where <code>auto</code> is set to <code>true</code>,
  <br><br>
  <ul>
    <li>If <code>type == "uuid"</code>, the field will take a random UUID as value.</li>
    <li>If <code>type == "string"</code>, the field will take a random string.</li>
    <li>If the field name is <code>created_at</code> or <code>updated_at</code>, the field will take the current time when
    inserting / updating, as appropriate.</li>
  </ul>
  </td>
</tr>
<tr>
  <td><code>reference</code></td>
  <td><code>string</code></td>
  <td>Required for fields of type <code>foreign</code>. The given string <em>must</em> be the name of an existing schema,
    to which the foreign key will "point to". This means that if a schema B has a foreign key pointing to schema A,
    then A needs to be loaded before B.
  </td>
</tr>
<tr>
  <td><code>on_delete</code></td>
  <td><code>string</code></td>
  <td>
    Optional and exclusive for fields of type <code>foreign</code>. It dictates what must happen
    with entities linked by a foreign key when the entity being referenced is deleted. It can have three possible
    values:<br><br>

    <ul>
      <li>
<code>"cascade"</code>: When the linked entity is deleted, all the dependent entities must also be deleted.</li>
      <li>
<code>"null"</code>: When the linked entity is deleted, all the dependent entities will have their foreign key
      field set to <code>null</code>.</li>
      <li>
<code>"restrict"</code>: Attempting to delete an entity with linked entities will result in an error.</li>
    </ul>

    <br><br>
    In Cassandra this is handled with pure Lua code, but in PostgreSQL it will be necessary to declare the references
    as <code>ON DELETE CASCADE/NULL/RESTRICT</code> in a migration.
  </td>
</tr>
</tbody>
</table>

<p>To learn more about schemas, see:</p>

<ul>
  <li>The source code of <a href="https://github.com/Kong/kong/blob/2.7.0/kong/db/schema/typedefs.lua" target="_blank" rel="noopener nofollow noreferrer ">typedefs.lua</a>
to get an idea of whatâ€™s provided there by default.</li>
  <li>
<a href="https://github.com/Kong/kong/tree/2.7.0/kong/db/schema/entities" target="_blank" rel="noopener nofollow noreferrer ">The Core Schemas</a>
to see examples of some other field attributes not discussed here.</li>
  <li>
<a href="https://github.com/search?utf8=%E2%9C%93&amp;q=repo%3Akong%2Fkong+path%3A%2Fkong%2Fplugins+filename%3Adaos.lua" target="_blank" rel="noopener nofollow noreferrer ">All the <code class="language-plaintext highlighter-rouge">daos.lua</code> files for embedded plugins</a>,
especially <a href="https://github.com/Kong/kong/blob/2.7.0/kong/plugins/key-auth/daos.lua" target="_blank" rel="noopener nofollow noreferrer ">the key-auth one</a>,
which was used for this guide as an example.</li>
</ul>

<h2 id="the-custom-dao">The custom DAO</h2>

<p>The schemas are not used directly to interact with the database. Instead, a DAO
is built for each valid schema. A DAO takes the name of the schema it wraps, and is
accessible through the <code class="language-plaintext highlighter-rouge">kong.db</code> interface.</p>

<p>For the example schema above, the DAO generated would be available for plugins
via <code class="language-plaintext highlighter-rouge">kong.db.keyauth_credentials</code>.</p>

<h3 id="select-an-entity">Select an entity</h3>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">entity</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">err_t</span> <span class="o">=</span> <span class="n">kong</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">:</span><span class="nb">select</span><span class="p">(</span><span class="n">primary_key</span><span class="p">)</span>
</code></pre></div></div>

<p>Attempts to find an entity in the database and return it. Three things can happen:</p>

<ul>
  <li>The entity was found. In this case, it is returned as a regular Lua table.</li>
  <li>An error occurred - for example the connection with the database was lost. In that
case the first returned value will be <code class="language-plaintext highlighter-rouge">nil</code>, the second one will be a string
describing the error, and the last one will be the same error in table form.</li>
  <li>An error does not occur but the entity is not found. Then the function will
just return <code class="language-plaintext highlighter-rouge">nil</code>, with no error.</li>
</ul>

<p>Example of usage:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">entity</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">kong</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">keyauth_credentials</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span>
  <span class="n">id</span> <span class="o">=</span> <span class="s2">"c77c50d2-5947-4904-9f37-fa36182a71a9"</span>
<span class="p">})</span>

<span class="k">if</span> <span class="n">err</span> <span class="k">then</span>
  <span class="n">kong</span><span class="p">.</span><span class="n">log</span><span class="p">.</span><span class="n">err</span><span class="p">(</span><span class="s2">"Error when inserting keyauth credential: "</span> <span class="o">..</span> <span class="n">err</span><span class="p">)</span>
  <span class="k">return</span> <span class="kc">nil</span>
<span class="k">end</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span> <span class="k">then</span>
  <span class="n">kong</span><span class="p">.</span><span class="n">log</span><span class="p">.</span><span class="n">err</span><span class="p">(</span><span class="s2">"Could not find credential."</span><span class="p">)</span>
  <span class="k">return</span> <span class="kc">nil</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="iterate-over-all-the-entities">Iterate over all the entities</h3>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">entity</span><span class="p">,</span> <span class="n">err</span> <span class="n">on</span> <span class="n">kong</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">:</span><span class="n">each</span><span class="p">(</span><span class="n">entities_per_page</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">if</span> <span class="n">err</span> <span class="k">then</span>
    <span class="o">...</span>
  <span class="k">end</span>
  <span class="o">...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This method efficiently iterates over all the entities in the database by making paginated
requests. The <code class="language-plaintext highlighter-rouge">entities_per_page</code> parameter, which defaults to <code class="language-plaintext highlighter-rouge">100</code>, controls how many
entities per page are returned.</p>

<p>On each iteration, a new <code class="language-plaintext highlighter-rouge">entity</code> will be returned or, if there is any error, the <code class="language-plaintext highlighter-rouge">err</code>
variable will be filled up with an error. The recommended way to iterate is checking <code class="language-plaintext highlighter-rouge">err</code> first,
and otherwise assume that <code class="language-plaintext highlighter-rouge">entity</code> is present.</p>

<p>Example of usage:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">credential</span><span class="p">,</span> <span class="n">err</span> <span class="n">on</span> <span class="n">kong</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">keyauth_credentials</span><span class="p">:</span><span class="n">each</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">if</span> <span class="n">err</span> <span class="k">then</span>
    <span class="n">kong</span><span class="p">.</span><span class="n">log</span><span class="p">.</span><span class="n">err</span><span class="p">(</span><span class="s2">"Error when iterating over keyauth credentials: "</span> <span class="o">..</span> <span class="n">err</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">nil</span>
  <span class="k">end</span>

  <span class="n">kong</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"id: "</span> <span class="o">..</span> <span class="n">credential</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This example iterates over the credentials in pages of 1000 items, logging their ids unless
an error happens.</p>

<h3 id="insert-an-entity">Insert an entity</h3>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">entity</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">err_t</span> <span class="o">=</span> <span class="n">kong</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">:</span><span class="n">insert</span><span class="p">(</span><span class="o">&lt;</span><span class="n">values</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div></div>

<p>Inserts an entity in the database, and returns a copy of the inserted entity, or
<code class="language-plaintext highlighter-rouge">nil</code>, an error message (a string) and a table describing the error in table form.</p>

<p>When the insert is successful, the returned entity contains the extra values produced by
<code class="language-plaintext highlighter-rouge">default</code> and <code class="language-plaintext highlighter-rouge">auto</code>.</p>

<p>The following example uses the <code class="language-plaintext highlighter-rouge">keyauth_credentials</code> DAO to insert a credential for a given
Consumer, setting its <code class="language-plaintext highlighter-rouge">key</code> to <code class="language-plaintext highlighter-rouge">"secret"</code>. Notice the syntax for referencing foreign keys.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">entity</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">kong</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">keyauth_credentials</span><span class="p">:</span><span class="n">insert</span><span class="p">({</span>
  <span class="n">consumer</span> <span class="o">=</span> <span class="p">{</span> <span class="n">id</span> <span class="o">=</span> <span class="s2">"c77c50d2-5947-4904-9f37-fa36182a71a9"</span> <span class="p">},</span>
  <span class="n">key</span> <span class="o">=</span> <span class="s2">"secret"</span><span class="p">,</span>
<span class="p">})</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span> <span class="k">then</span>
  <span class="n">kong</span><span class="p">.</span><span class="n">log</span><span class="p">.</span><span class="n">err</span><span class="p">(</span><span class="s2">"Error when inserting keyauth credential: "</span> <span class="o">..</span> <span class="n">err</span><span class="p">)</span>
  <span class="k">return</span> <span class="kc">nil</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The returned entity, assuming no error happened will have <code class="language-plaintext highlighter-rouge">auto</code>-filled fields, like <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">created_at</code>.</p>

<h3 id="update-an-entity">Update an entity</h3>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">entity</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">err_t</span> <span class="o">=</span> <span class="n">kong</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">:</span><span class="n">update</span><span class="p">(</span><span class="n">primary_key</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">values</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div></div>

<p>Updates an existing entity, provided it can be found using the provided primary key and a set of values.</p>

<p>The returned entity will be the entity after the update takes place, or <code class="language-plaintext highlighter-rouge">nil</code> + an error message + an error table.</p>

<p>The following example modifies the <code class="language-plaintext highlighter-rouge">key</code> field of an existing credential given the credentialâ€™s id:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">entity</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">kong</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">keyauth_credentials</span><span class="p">:</span><span class="n">update</span><span class="p">(</span>
  <span class="p">{</span> <span class="n">id</span> <span class="o">=</span> <span class="s2">"2b6a2022-770a-49df-874d-11e2bf2634f5"</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">"updated_secret"</span> <span class="p">},</span>
<span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span> <span class="k">then</span>
  <span class="n">kong</span><span class="p">.</span><span class="n">log</span><span class="p">.</span><span class="n">err</span><span class="p">(</span><span class="s2">"Error when updating keyauth credential: "</span> <span class="o">..</span> <span class="n">err</span><span class="p">)</span>
  <span class="k">return</span> <span class="kc">nil</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Notice how the syntax for specifying a primary key is similar to the one used to specify a foreign key.</p>

<h3 id="upsert-an-entity">Upsert an entity</h3>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">entity</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">err_t</span> <span class="o">=</span> <span class="n">kong</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">:</span><span class="n">upsert</span><span class="p">(</span><span class="n">primary_key</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">values</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">upsert</code> is a mixture of <code class="language-plaintext highlighter-rouge">insert</code> and <code class="language-plaintext highlighter-rouge">update</code>:</p>

<ul>
  <li>When the provided <code class="language-plaintext highlighter-rouge">primary_key</code> identifies an existing entity, it works like <code class="language-plaintext highlighter-rouge">update</code>.</li>
  <li>When the provided <code class="language-plaintext highlighter-rouge">primary_key</code> does not identify an existing entity, it works like <code class="language-plaintext highlighter-rouge">insert</code>
</li>
</ul>

<p>Given this code:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">entity</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">kong</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">keyauth_credentials</span><span class="p">:</span><span class="n">upsert</span><span class="p">(</span>
  <span class="p">{</span> <span class="n">id</span> <span class="o">=</span> <span class="s2">"2b6a2022-770a-49df-874d-11e2bf2634f5"</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">consumer</span> <span class="o">=</span> <span class="p">{</span> <span class="n">id</span> <span class="o">=</span> <span class="s2">"a96145fb-d71e-4c88-8a5a-2c8b1947534c"</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span> <span class="k">then</span>
  <span class="n">kong</span><span class="p">.</span><span class="n">log</span><span class="p">.</span><span class="n">err</span><span class="p">(</span><span class="s2">"Error when upserting keyauth credential: "</span> <span class="o">..</span> <span class="n">err</span><span class="p">)</span>
  <span class="k">return</span> <span class="kc">nil</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Two things can happen:</p>

<ul>
  <li>If a credential with id <code class="language-plaintext highlighter-rouge">2b6a2022-770a-49df-874d-11e2bf2634f5</code> exists,
then this code will attempt to set its Consumer to the provided one.</li>
  <li>If the credential does not exist, then this code is attempting to create
a new credential, with the given id and Consumer.</li>
</ul>

<h3 id="delete-an-entity">Delete an entity</h3>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">ok</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">err_t</span> <span class="o">=</span> <span class="n">kong</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">:</span><span class="n">delete</span><span class="p">(</span><span class="n">primary_key</span><span class="p">)</span>
</code></pre></div></div>

<p>Attempts to delete the entity identified by <code class="language-plaintext highlighter-rouge">primary_key</code>. It returns <code class="language-plaintext highlighter-rouge">true</code>
if the entity <em>doesnâ€™t exist</em> after calling this method, or <code class="language-plaintext highlighter-rouge">nil</code> + error +
error table if an error is detected.</p>

<p>Notice that calling <code class="language-plaintext highlighter-rouge">delete</code> will succeed if the entity didnâ€™t exist <em>before
calling it</em>. This is for performance reasons - we want to avoid doing a
read-before-delete if we can avoid it. If you want to do this check, you
must do it manually, by checking with <code class="language-plaintext highlighter-rouge">select</code> before invoking <code class="language-plaintext highlighter-rouge">delete</code>.</p>

<p>Example:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">ok</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">kong</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">keyauth_credentials</span><span class="p">:</span><span class="n">delete</span><span class="p">({</span>
  <span class="n">id</span> <span class="o">=</span> <span class="s2">"2b6a2022-770a-49df-874d-11e2bf2634f5"</span>
<span class="p">})</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span> <span class="k">then</span>
  <span class="n">kong</span><span class="p">.</span><span class="n">log</span><span class="p">.</span><span class="n">err</span><span class="p">(</span><span class="s2">"Error when deleting keyauth credential: "</span> <span class="o">..</span> <span class="n">err</span><span class="p">)</span>
  <span class="k">return</span> <span class="kc">nil</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="cache-custom-entities">Cache custom entities</h2>

<p>Sometimes custom entities are required on every request/response, which in turn
triggers a query on the datastore every time. This is very inefficient because
querying the datastore adds latency and slows the request/response down, and
the resulting increased load on the datastore could affect the datastore
performance itself and, in turn, other Kong nodes.</p>

<p>When a custom entity is required on every request/response it is good practice
to cache it in-memory by leveraging the in-memory cache API provided by Kong.</p>

<p>The next chapter will focus on caching custom entities, and invalidating them
when they change in the datastore: <a href="/gateway/2.7.x/plugin-development/entities-cache/">Caching custom entities</a>.</p>



          
  <div class="book-nav-container">
    <hr>
    
      <div class="book-nav previous">
        <span class="direction">Previous</span>
        <a href="/gateway/2.7.x/plugin-development/access-the-datastore/">Plugin Development - Accessing the Datastore</a>
      </div>
    
    
      <div class="book-nav next">
        <span class="direction">Next</span>
        <a href="/gateway/2.7.x/plugin-development/entities-cache/">Plugin Development - Caching Custom Entities</a>
      </div>
    
  </div>


        </div>
      </div>
    </div>
    
      <div id="scroll-to-top-button">
        <i class="fas fa-chevron-up"></i>
      </div>
      
        <div class="feedback-widget-container">
  <input id="feedback-widget-checkbox" type="checkbox">
  <label for="feedback-widget-checkbox">
    <img src="/assets/images/icons/feedback-widget.svg" alt="Feedback widget">
  </label>
  <div class="feedback-container">
    <div class="feedback-thankyou">
      Thank you for your feedback.
    </div>
    <div class="feedback-comment">
      <textarea id="feedback-comment-text" rows="3" placeholder="Please let us know what we can improve on this page..."></textarea>
      <div class="feedback-comment-buttons">
        <button id="feedback-comment-button-back">Back</button>
        <button id="feedback-comment-button-submit" class="button-primary">Submit</button>
      </div>
    </div>
    <div class="feedback-options">
      <div class="feedback-options-title">Was this page useful?</div>
      <div class="feedback-options-buttons">
        <i data-feedback-result="yes" class="feedback-options-button far fa-thumbs-up"></i>
        <i data-feedback-result="no" class="feedback-options-button far fa-thumbs-down"></i>
      </div>
    </div>
  </div>
</div>

      
    
  </div>

  <div id="image-modal" data-image-expand-disabled="">
  <div class="image-modal-backdrop"></div>
  <div class="image-container">
    <img src="" alt="">
    <i class="fa fa-times"></i>
  </div>
</div>




  <div class="modal closed" id="modal" role="dialog" aria-hidden="true" aria-labelledby="title" aria-describedby="description">
    <div class="konnect-cta-card">
      <div class="title">
      Too much on your plate?
      <a href="#" class="cta-card-close modal-close" id="modal-close">
          <img src="/assets/images/icons/documentation/close.svg" alt="close cta icon">
        </a>
      </div>
      <div class="description">More features, less infrastructure with Kong Konnect. 1M requests per month for free.</div>
      <a href="https://konghq.com/products/kong-konnect/register?utm_medium=referral&amp;utm_source=docs&amp;utm_campaign=gateway-konnect&amp;utm_campaign=right-nav-card&amp;utm_content=gateway" class="button" target="_blank" rel="noopener nofollow noreferrer ">
      Try it for Free
    </a>
    </div>
  </div>
  <div id="modal-open" class="modal-open"></div>
  <div class="modal-overlay closed" id="modal-overlay"></div>



    <footer class="marketing-footer--light-gray">
  <section>
    <ul class="newsletter">
      <li class="logo-wrapper">
        <div class="logo">
          <img src="/assets/images/logos/kong-logo-blue.svg" alt="Kong">
        </div>
        <div class="footer-title">Powering the API world</div>
        <p>
          Increase developer productivity, security, and performance at scale with the unified platform for API management, service mesh, and ingress controller.
        </p>
        <div class="footer-form-container">
          <form id="subscribe-form" method="POST" action="/assets/javascripts/subscribe.js">
            <input required id="subscribe-input" type="email" name="email" placeholder="Email" aria-required="true" aria-invalid="false">
            <input id="footer-form-button" type="submit" form="subscribe-form" value="Subscribe">
          </form>

          <div id="form-response"></div>
        </div>
      </li>

      <li class="footer-columns">
        <ul class="footer-columns-product-list">
          <li>
            <nav>
              <div class="footer-category">Products</div>
              <ul>
                <li>
                  <a href="https://konghq.com/products/kong-konnect" target="_blank" rel="noopener nofollow noreferrer ">Kong Konnect</a>
                </li>
                <li>
                  <a href="https://konghq.com/products/kong-enterprise" target="_blank" rel="noopener nofollow noreferrer ">Kong Gateway Enterprise</a>
                </li>
                <li>
                  <a href="https://konghq.com/products/kong-gateway" target="_blank" rel="noopener nofollow noreferrer ">Kong Gateway</a>
                </li>
                <li>
                  <a href="https://konghq.com/products/kong-mesh" target="_blank" rel="noopener nofollow noreferrer ">Kong Mesh</a>
                </li>
                <li>
                  <a href="https://konghq.com/products/kong-ingress-controller" target="_blank" rel="noopener nofollow noreferrer ">Kong Ingress Controller</a>
                </li>
                <li>
                  <a href="https://insomnia.rest/" target="_blank" rel="noopener nofollow noreferrer noopener nofollow noreferrer">Kong Insomnia</a>
                </li>
                <li>
                  <a href="https://konghq.com/product-updates" target="_blank" rel="noopener nofollow noreferrer ">Product Updates</a>
                </li>
                <li>
                  <a href="https://konghq.com/contact-sales" target="_blank" rel="noopener nofollow noreferrer ">Get Started</a>
                </li>
              </ul>
            </nav>
          </li>
          <li>
            <nav>
              <div class="footer-category">Documentation</div>
              <ul>
                <li>
                  <a href="/konnect/">Kong Konnect Docs</a>
                </li>
                <li>
                  <a href="/gateway/latest/">Kong Gateway Docs</a>
                </li>
                <li>
                  <a href="/gateway/latest/kong-enterprise/">Kong Gateway Enterprise Docs</a>
                </li>
                <li>
                  <a href="/mesh/latest/">Kong Mesh Docs</a>
                </li>
                <li>
                  <a href="https://docs.insomnia.rest/" target="_blank" rel="noopener nofollow noreferrer noopener nofollow noreferrer">Kong Insomnia Docs</a>
                </li>
                <li>
                  <a href="/hub/">Kong Konnect Plugin Hub</a>
                </li>
              </ul>
            </nav>
          </li>
          <li>
            <nav>
              <div class="footer-category">Open Source</div>
              <ul>
                <li>
                  <a href="https://konghq.com/install/#kong-community" target="_blank" rel="noopener nofollow noreferrer ">Kong Gateway</a>
                </li>
                <li>
                  <a href="https://kuma.io/" target="_blank" rel="noopener nofollow noreferrer noopener nofollow noreferrer">Kuma</a>
                </li>
                <li>
                  <a href="https://insomnia.rest/" target="_blank" rel="noopener nofollow noreferrer noopener nofollow noreferrer">Insomnia</a>
                </li>
                <li>
                  <a href="https://konghq.com/community" target="_blank" rel="noopener nofollow noreferrer ">Kong Community</a>
                </li>
              </ul>
            </nav>
          </li>
          <li>
            <nav>
              <div class="footer-category">Company</div>
              <ul>
                <li>
                  <a href="https://konghq.com/company/about-us" target="_blank" rel="noopener nofollow noreferrer ">About Kong</a>
                </li>
                <li>
                  <a href="https://konghq.com/customers" target="_blank" rel="noopener nofollow noreferrer ">Customers</a>
                </li>
                <li>
                  <a href="https://konghq.com/company/careers" target="_blank" rel="noopener nofollow noreferrer ">Careers</a>
                </li>
                <li>
                  <a href="https://konghq.com/press-room" target="_blank" rel="noopener nofollow noreferrer ">Press</a>
                </li>
                <li>
                  <a href="https://konghq.com/events" target="_blank" rel="noopener nofollow noreferrer ">Events</a>
                </li>
                <li>
                  <a href="https://konghq.com/company/contact-us" target="_blank" rel="noopener nofollow noreferrer ">Contact</a>
                </li>
              </ul>
            </nav>
          </li>
        </ul>
      </li>

    </ul>
  </section>

  <section class="legal">
    <div class="container d-flex">
      <div class="social">
        <div class="social-link">
          <a href="https://www.facebook.com/konghq/" title="Facebook" target="_blank" rel="noopener nofollow noreferrer "><i aria-label="Facebook" class="fa fa-facebook-official" aria-hidden="true"></i></a>
        </div>
        <div class="social-link">
          <a href="https://twitter.com/thekonginc" title="Twitter" target="_blank" rel="noopener nofollow noreferrer "><i aria-label="Twitter" class="fa fa-twitter" aria-hidden="true"></i></a>
        </div>
        <div class="social-link">
          <a href="https://www.meetup.com/topics/kong/all/" title="Meetup" target="_blank" rel="noopener nofollow noreferrer "><i aria-label="Meetup" class="fa fa-meetup" aria-hidden="true"></i></a>
        </div>
        <div class="social-link">
          <a href="https://linkedin.com/company/278819" title="LinkedIn" target="_blank" rel="noopener nofollow noreferrer "><i aria-label="GitHub" class="fa fa-linkedin" aria-hidden="true"></i></a>
        </div>
        <div class="social-link">
          <a href="https://github.com/kong/kong" target="_blank" class="btn-gh" title="GitHub" rel="noopener nofollow noreferrer ">
            <i class="fa fa-github" aria-hidden="true" aria-label="GitHub"></i>
          </a>
        </div>
      </div>
      <ul>
        <li>
          <span class="mashape-footer-content">
            <a href="https://konghq.com/terms" target="_blank" rel="noopener nofollow noreferrer ">Terms</a><b>â€¢</b>
            <a href="https://konghq.com/privacy" target="_blank" rel="noopener nofollow noreferrer ">Privacy</a><b>â€¢</b>
            <a href="https://konghq.com/compliance" target="_blank" rel="noopener nofollow noreferrer ">Trust and Compliance</a>
          </span>
        </li>
      </ul>
      <div>
        <span>Â© Kong Inc. 2024 Â </span>
      </div>
    </div>
  </section>

  <script type="text/javascript">
    function onSubmit(response) {
      document.getElementById("subscription_form").submit();
      document.getElementById("follow_up_subscription_form").submit();
      if (response.length == 0) {
        alert("reCaptcha verification failed");
      }
    }
  </script>
</footer>
 <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<i class=\"fa fa-link\"></i>";
    anchor.title = `${id} Permalink`;
    return anchor;
  };

  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var className =
        ".show-anchor-links h1, .show-anchor-links h2, .show-anchor-links h3, " +
        ".show-anchor-links h4, .show-anchor-links h5, .show-anchor-links h6";
      var headers = document.querySelectorAll(className);

      for (var i = 0; i < headers.length; i++) {
        var header = headers[i];
        if (typeof header.id !== "undefined" && header.id !== "") {
          header.prepend(anchorForId(header.id));
        }
      }
    }
  };
</script>


    
      <script>
        (function stp(){
          if (typeof analytics == "undefined"){
            return setTimeout(stp, 30);
          }
          analytics.page();
        })();
      </script>
    

    <div id="fb-root"></div>
    <script id="github-bjs" src="https://buttons.github.io/buttons.js" async defer></script>

    <script type="text/javascript">
      var _vwo_code = (function() {
        var account_id = 125292,
          settings_tolerance = 2000,
          library_tolerance = 2500,
          use_existing_jquery = true,
          // DO NOT EDIT BELOW THIS LINE
          f = false,
          d = document;
        return {
          use_existing_jquery: function() {
            return use_existing_jquery;
          },
          library_tolerance: function() {
            return library_tolerance;
          },
          finish: function() {
            if (!f) {
              f = true;
              var a = d.getElementById('_vis_opt_path_hides');
              if (a) a.parentNode.removeChild(a);
            }
          },
          finished: function() {
            return f;
          },
          load: function(a) {
            var b = d.createElement('script');
            b.src = a;
            b.type = 'text/javascript';
            b.innerText;
            b.onerror = function() {
              _vwo_code.finish();
            };
            d.getElementsByTagName('head')[0].appendChild(b);
          },
          init: function() {
            settings_timer = setTimeout(
              '_vwo_code.finish()',
              settings_tolerance
            );
            this.load(
              '//dev.visualwebsiteoptimizer.com/j.php?a=' +
                account_id +
                '&u=' +
                encodeURIComponent(d.URL) +
                '&r=' +
                Math.random()
            );
            var a = d.createElement('style'),
              b = '',
              h = d.getElementsByTagName('head')[0];
            a.setAttribute('id', '_vis_opt_path_hides');
            a.setAttribute('type', 'text/css');
            if (a.styleSheet) a.styleSheet.cssText = b;
            else a.appendChild(d.createTextNode(b));
            h.appendChild(a);
            return settings_timer;
          }
        };
      })();
      _vwo_settings_timer = _vwo_code.init();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>

    
      <script type="text/javascript">
        docsearch({
          appId: '05Y6TLHNFZ',
          apiKey: '80483bfe28d9fd036a11a6f6a06454f8',
          indexName: 'konghq',
          container: '#getkong-algolia-search-input',
          disableUserPersonalization: true,
          placeholder: 'Search the docs...',
          // Override selected event to allow for local environment navigation
          transformItems(items) {
            return items.map((item) => {
              var modifiedUrl = window.location.protocol + '//' + window.location.host + item.url.split('docs.konghq.com')[1];
              return { ...item, url: modifiedUrl };
            });
          },
          translations: {
            button: {
              buttonText: 'Search the docs..',
              buttonAriaLabel: 'Search the docs...'
            }
          },
          resultsFooterComponent({ state }) {
            var facetParameters = {};
            
              facetParameters = {"version[0]":"2.7.x","product[0]":"Kong Gateway"};
            

            var queryParams = new URLSearchParams(facetParameters);
            queryParams.set('query', state.query);

            return {
              // The HTML `tag`
              type: 'a',
              ref: undefined,
              constructor: undefined,
              key: state.query,
              // Its props
              props: {
                href: `/search/?${queryParams.toString()}`,
                target: '_blank',
                // Raw text rendered in the HTML element
                children: 'See more >'
              },
              __v: null,
            };
          },
          
           searchParameters: {
              optionalFilters: ['product:deck<score=1>', 'product:Plugin Hub<score=2>', 'product:Kong Gateway<score=3>'],
              facetFilters: [ 'version:2.7.x']
            }
            
          });
      </script>
    
  </div>
</body>

  

</html>
